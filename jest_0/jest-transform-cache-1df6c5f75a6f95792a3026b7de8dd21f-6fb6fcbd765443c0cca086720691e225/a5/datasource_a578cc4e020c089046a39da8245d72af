fe178384090a73847319d0f1c3d00429
'use strict';Object.defineProperty(exports, "__esModule", { value: true });exports.zabbixTemplateFormat = exports.ZabbixAPIDatasource = undefined;var _slicedToArray = function () {function sliceIterator(arr, i) {var _arr = [];var _n = true;var _d = false;var _e = undefined;try {for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {_arr.push(_s.value);if (i && _arr.length === i) break;}} catch (err) {_d = true;_e = err;} finally {try {if (!_n && _i["return"]) _i["return"]();} finally {if (_d) throw _e;}}return _arr;}return function (arr, i) {if (Array.isArray(arr)) {return arr;} else if (Symbol.iterator in Object(arr)) {return sliceIterator(arr, i);} else {throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();var _lodash = require('lodash');var _lodash2 = _interopRequireDefault(_lodash);
var _datemath = require('app/core/utils/datemath');var dateMath = _interopRequireWildcard(_datemath);
var _utils = require('./utils');var utils = _interopRequireWildcard(_utils);
var _migrations = require('./migrations');var migrations = _interopRequireWildcard(_migrations);
var _metricFunctions = require('./metricFunctions');var metricFunctions = _interopRequireWildcard(_metricFunctions);
var _constants = require('./constants');var c = _interopRequireWildcard(_constants);
var _dataProcessor = require('./dataProcessor');var _dataProcessor2 = _interopRequireDefault(_dataProcessor);
var _responseHandler = require('./responseHandler');var _responseHandler2 = _interopRequireDefault(_responseHandler);
require('./zabbix.js');
require('./zabbixAlerting.service.js');
var _zabbixAPICoreService = require('./zabbixAPICore.service.js');function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;} else {var newObj = {};if (obj != null) {for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj.default = obj;return newObj;}}function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}var

ZabbixAPIDatasource = function () {

  /** @ngInject */
  function ZabbixAPIDatasource(instanceSettings, templateSrv, alertSrv, dashboardSrv, zabbixAlertingSrv, Zabbix) {_classCallCheck(this, ZabbixAPIDatasource);
    this.templateSrv = templateSrv;
    this.alertSrv = alertSrv;
    this.dashboardSrv = dashboardSrv;
    this.zabbixAlertingSrv = zabbixAlertingSrv;

    // Use custom format for template variables
    this.replaceTemplateVars = _lodash2.default.partial(replaceTemplateVars, this.templateSrv);

    // General data source settings
    this.name = instanceSettings.name;
    this.url = instanceSettings.url;
    this.basicAuth = instanceSettings.basicAuth;
    this.withCredentials = instanceSettings.withCredentials;

    var jsonData = instanceSettings.jsonData || {};

    // Zabbix API credentials
    this.username = jsonData.username;
    this.password = jsonData.password;

    // Use trends instead history since specified time
    this.trends = jsonData.trends;
    this.trendsFrom = jsonData.trendsFrom || '7d';
    this.trendsRange = jsonData.trendsRange || '4d';

    // Set cache update interval
    var ttl = jsonData.cacheTTL || '1h';
    this.cacheTTL = utils.parseInterval(ttl);

    // Alerting options
    this.alertingEnabled = jsonData.alerting;
    this.addThresholds = jsonData.addThresholds;
    this.alertingMinSeverity = jsonData.alertingMinSeverity || c.SEV_WARNING;

    // Other options
    this.disableReadOnlyUsersAck = jsonData.disableReadOnlyUsersAck;

    // Direct DB Connection options
    var dbConnectionOptions = jsonData.dbConnection || {};
    this.enableDirectDBConnection = dbConnectionOptions.enable;
    this.sqlDatasourceId = dbConnectionOptions.datasourceId;

    var zabbixOptions = {
      username: this.username,
      password: this.password,
      basicAuth: this.basicAuth,
      withCredentials: this.withCredentials,
      cacheTTL: this.cacheTTL,
      enableDirectDBConnection: this.enableDirectDBConnection,
      sqlDatasourceId: this.sqlDatasourceId };


    this.zabbix = new Zabbix(this.url, zabbixOptions);
  }

  ////////////////////////
  // Datasource methods //
  ////////////////////////

  /**
   * Query panel data. Calls for each panel in dashboard.
   * @param  {Object} options   Contains time range, targets and other info.
   * @return {Object} Grafana metrics object with timeseries data for each target.
   */_createClass(ZabbixAPIDatasource, [{ key: 'query', value: function query(
    options) {var _this = this;
      // Get alerts for current panel
      if (this.alertingEnabled) {
        this.alertQuery(options).then(function (alert) {
          _this.zabbixAlertingSrv.setPanelAlertState(options.panelId, alert.state);

          _this.zabbixAlertingSrv.removeZabbixThreshold(options.panelId);
          if (_this.addThresholds) {
            _lodash2.default.forEach(alert.thresholds, function (threshold) {
              _this.zabbixAlertingSrv.setPanelThreshold(options.panelId, threshold);
            });
          }
        });
      }

      // Create request for each target
      var promises = _lodash2.default.map(options.targets, function (t) {
        // Don't request undefined and hidden targets
        if (t.hide) {
          return [];
        }

        var timeFrom = Math.ceil(dateMath.parse(options.range.from) / 1000);
        var timeTo = Math.ceil(dateMath.parse(options.range.to) / 1000);

        // Prevent changes of original object
        var target = _lodash2.default.cloneDeep(t);
        _this.replaceTargetVariables(target, options);

        // Apply Time-related functions (timeShift(), etc)
        var timeFunctions = bindFunctionDefs(target.functions, 'Time');
        if (timeFunctions.length) {var _sequence =
          sequence(timeFunctions)([timeFrom, timeTo]),_sequence2 = _slicedToArray(_sequence, 2),time_from = _sequence2[0],time_to = _sequence2[1];
          timeFrom = time_from;
          timeTo = time_to;
        }
        var timeRange = [timeFrom, timeTo];

        var useTrends = _this.isUseTrends(timeRange);

        // Metrics or Text query mode
        if (!target.mode || target.mode === c.MODE_METRICS || target.mode === c.MODE_TEXT) {
          // Migrate old targets
          target = migrations.migrate(target);

          // Don't request undefined and hidden targets
          if (target.hide || !target.group || !target.host || !target.item) {
            return [];
          }

          if (!target.mode || target.mode === c.MODE_METRICS) {
            return _this.queryNumericData(target, timeRange, useTrends, options);
          } else if (target.mode === c.MODE_TEXT) {
            return _this.queryTextData(target, timeRange);
          }
        } else if (target.mode === c.MODE_ITEMID) {
          // Item ID mode
          if (!target.itemids) {
            return [];
          }
          return _this.queryItemIdData(target, timeRange, useTrends, options);
        } else if (target.mode === c.MODE_ITSERVICE) {
          // IT services mode
          return _this.queryITServiceData(target, timeRange, options);
        } else if (target.mode === c.MODE_TRIGGERS) {
          // Triggers mode
          return _this.queryTriggersData(target, timeRange);
        } else {
          return [];
        }
      });

      // Data for panel (all targets)
      return Promise.all(_lodash2.default.flatten(promises)).
      then(_lodash2.default.flatten).
      then(function (data) {
        return { data: data };
      });
    }

    /**
       * Query target data for Metrics mode
       */ }, { key: 'queryNumericData', value: function queryNumericData(
    target, timeRange, useTrends, options) {var _this2 = this;
      var getItemOptions = {
        itemtype: 'num' };

      return this.zabbix.getItemsFromTarget(target, getItemOptions).
      then(function (items) {
        return _this2.queryNumericDataForItems(items, target, timeRange, useTrends, options);
      });
    }

    /**
       * Query history for numeric items
       */ }, { key: 'queryNumericDataForItems', value: function queryNumericDataForItems(
    items, target, timeRange, useTrends, options) {var _this3 = this;var _timeRange = _slicedToArray(
      timeRange, 2),timeFrom = _timeRange[0],timeTo = _timeRange[1];
      var getHistoryPromise = void 0;
      options.consolidateBy = getConsolidateBy(target);

      if (useTrends) {
        if (this.enableDirectDBConnection) {
          getHistoryPromise = this.zabbix.getTrendsDB(items, timeFrom, timeTo, options).
          then(function (history) {return _this3.zabbix.dbConnector.handleGrafanaTSResponse(history, items);});
        } else {
          var valueType = this.getTrendValueType(target);
          getHistoryPromise = this.zabbix.getTrend(items, timeFrom, timeTo).
          then(function (history) {return _responseHandler2.default.handleTrends(history, items, valueType);}).
          then(function (timeseries) {
            // Sort trend data, issue #202
            _lodash2.default.forEach(timeseries, function (series) {
              series.datapoints = _lodash2.default.sortBy(series.datapoints, function (point) {return point[c.DATAPOINT_TS];});
            });
            return timeseries;
          });
        }
      } else {
        // Use history
        if (this.enableDirectDBConnection) {
          getHistoryPromise = this.zabbix.getHistoryDB(items, timeFrom, timeTo, options).
          then(function (history) {return _this3.zabbix.dbConnector.handleGrafanaTSResponse(history, items);});
        } else {
          getHistoryPromise = this.zabbix.getHistory(items, timeFrom, timeTo, target.limit).
          then(function (history) {return _responseHandler2.default.handleHistory(history, items);});
        }
      }

      return getHistoryPromise.
      then(function (timeseries) {return _this3.applyDataProcessingFunctions(timeseries, target);}).
      then(function (timeseries) {return downsampleSeries(timeseries, options);});
    } }, { key: 'getTrendValueType', value: function getTrendValueType(

    target) {
      // Find trendValue() function and get specified trend value
      var trendFunctions = _lodash2.default.map(metricFunctions.getCategories()['Trends'], 'name');
      var trendValueFunc = _lodash2.default.find(target.functions, function (func) {
        return _lodash2.default.includes(trendFunctions, func.def.name);
      });
      return trendValueFunc ? trendValueFunc.params[0] : "avg";
    } }, { key: 'applyDataProcessingFunctions', value: function applyDataProcessingFunctions(

    timeseries_data, target) {
      var transformFunctions = bindFunctionDefs(target.functions, 'Transform');
      var aggregationFunctions = bindFunctionDefs(target.functions, 'Aggregate');
      var filterFunctions = bindFunctionDefs(target.functions, 'Filter');
      var aliasFunctions = bindFunctionDefs(target.functions, 'Alias');

      // Apply transformation functions
      timeseries_data = _lodash2.default.cloneDeep(_lodash2.default.map(timeseries_data, function (timeseries) {
        timeseries.datapoints = sequence(transformFunctions)(timeseries.datapoints);
        return timeseries;
      }));

      // Apply filter functions
      if (filterFunctions.length) {
        timeseries_data = sequence(filterFunctions)(timeseries_data);
      }

      // Apply aggregations
      if (aggregationFunctions.length) {
        var dp = _lodash2.default.map(timeseries_data, 'datapoints');
        dp = sequence(aggregationFunctions)(dp);

        var aggFuncNames = _lodash2.default.map(metricFunctions.getCategories()['Aggregate'], 'name');
        var lastAgg = _lodash2.default.findLast(target.functions, function (func) {
          return _lodash2.default.includes(aggFuncNames, func.def.name);
        });

        timeseries_data = [{
          target: lastAgg.text,
          datapoints: dp }];

      }

      // Apply alias functions
      _lodash2.default.forEach(timeseries_data, sequence(aliasFunctions));

      // Apply Time-related functions (timeShift(), etc)
      // Find timeShift() function and get specified trend value
      this.applyTimeShiftFunction(timeseries_data, target);

      return timeseries_data;
    } }, { key: 'applyTimeShiftFunction', value: function applyTimeShiftFunction(

    timeseries_data, target) {
      // Find timeShift() function and get specified interval
      var timeShiftFunc = _lodash2.default.find(target.functions, function (func) {
        return func.def.name === 'timeShift';
      });
      if (timeShiftFunc) {
        var shift = timeShiftFunc.params[0];
        _lodash2.default.forEach(timeseries_data, function (series) {
          series.datapoints = _dataProcessor2.default.unShiftTimeSeries(shift, series.datapoints);
        });
      }
    }

    /**
       * Query target data for Text mode
       */ }, { key: 'queryTextData', value: function queryTextData(
    target, timeRange) {var _this4 = this;var _timeRange2 = _slicedToArray(
      timeRange, 2),timeFrom = _timeRange2[0],timeTo = _timeRange2[1];
      var options = {
        itemtype: 'text' };

      return this.zabbix.getItemsFromTarget(target, options).
      then(function (items) {
        if (items.length) {
          return _this4.zabbix.getHistory(items, timeFrom, timeTo).
          then(function (history) {
            if (target.resultFormat === 'table') {
              return _responseHandler2.default.handleHistoryAsTable(history, items, target);
            } else {
              return _responseHandler2.default.handleText(history, items, target);
            }
          });
        } else {
          return Promise.resolve([]);
        }
      });
    }

    /**
       * Query target data for Item ID mode
       */ }, { key: 'queryItemIdData', value: function queryItemIdData(
    target, timeRange, useTrends, options) {var _this5 = this;
      var itemids = target.itemids;
      itemids = this.templateSrv.replace(itemids, options.scopedVars, zabbixItemIdsTemplateFormat);
      itemids = _lodash2.default.map(itemids.split(','), function (itemid) {return itemid.trim();});

      if (!itemids) {
        return [];
      }

      return this.zabbix.getItemsByIDs(itemids).
      then(function (items) {
        return _this5.queryNumericDataForItems(items, target, timeRange, useTrends, options);
      });
    }

    /**
       * Query target data for IT Services mode
       */ }, { key: 'queryITServiceData', value: function queryITServiceData(
    target, timeRange, options) {var _this6 = this;
      // Don't show undefined and hidden targets
      if (target.hide || !target.itservice && !target.itServiceFilter || !target.slaProperty) {
        return [];
      }

      var itServiceIds = [];
      var itServices = [];
      var itServiceFilter = void 0;
      var isOldVersion = target.itservice && !target.itServiceFilter;

      if (isOldVersion) {
        // Backward compatibility
        itServiceFilter = '/.*/';
      } else {
        itServiceFilter = this.replaceTemplateVars(target.itServiceFilter, options.scopedVars);
      }

      return this.zabbix.getITServices(itServiceFilter).
      then(function (itservices) {
        itServices = itservices;
        if (isOldVersion) {
          itServices = _lodash2.default.filter(itServices, { 'serviceid': target.itservice.serviceid });
        }

        itServiceIds = _lodash2.default.map(itServices, 'serviceid');
        return itServiceIds;
      }).
      then(function (serviceids) {
        return _this6.zabbix.getSLA(serviceids, timeRange);
      }).
      then(function (slaResponse) {
        return _lodash2.default.map(itServiceIds, function (serviceid) {
          var itservice = _lodash2.default.find(itServices, { 'serviceid': serviceid });
          return _responseHandler2.default.handleSLAResponse(itservice, target.slaProperty, slaResponse);
        });
      });
    } }, { key: 'queryTriggersData', value: function queryTriggersData(

    target, timeRange) {var _this7 = this;var _timeRange3 = _slicedToArray(
      timeRange, 2),timeFrom = _timeRange3[0],timeTo = _timeRange3[1];
      return this.zabbix.getHostsFromTarget(target).
      then(function (results) {var _results = _slicedToArray(
        results, 2),hosts = _results[0],apps = _results[1];
        if (hosts.length) {
          var hostids = _lodash2.default.map(hosts, 'hostid');
          var appids = _lodash2.default.map(apps, 'applicationid');
          var options = {
            minSeverity: target.triggers.minSeverity,
            acknowledged: target.triggers.acknowledged,
            count: target.triggers.count,
            timeFrom: timeFrom,
            timeTo: timeTo };

          return _this7.zabbix.getHostAlerts(hostids, appids, options).
          then(function (triggers) {
            return _responseHandler2.default.handleTriggersResponse(triggers, timeRange);
          });
        } else {
          return Promise.resolve([]);
        }
      });
    }

    /**
       * Test connection to Zabbix API
       * @return {object} Connection status and Zabbix API version
       */ }, { key: 'testDatasource', value: function testDatasource()
    {var _this8 = this;
      var zabbixVersion = void 0;
      return this.zabbix.getVersion().
      then(function (version) {
        zabbixVersion = version;
        return _this8.zabbix.login();
      }).
      then(function () {
        if (_this8.enableDirectDBConnection) {
          return _this8.zabbix.dbConnector.testSQLDataSource();
        } else {
          return Promise.resolve();
        }
      }).
      then(function () {
        return {
          status: "success",
          title: "Success",
          message: "Zabbix API version: " + zabbixVersion };

      }).
      catch(function (error) {
        if (error instanceof _zabbixAPICoreService.ZabbixAPIError) {
          return {
            status: "error",
            title: error.message,
            message: error.message };

        } else if (error.data && error.data.message) {
          return {
            status: "error",
            title: "Connection failed",
            message: "Connection failed: " + error.data.message };

        } else {
          return {
            status: "error",
            title: "Connection failed",
            message: "Could not connect to given url" };

        }
      });
    }

    ////////////////
    // Templating //
    ////////////////

    /**
     * Find metrics from templated request.
     *
     * @param  {string} query Query from Templating
     * @return {string}       Metric name - group, host, app or item or list
     *                        of metrics in "{metric1,metcic2,...,metricN}" format.
     */ }, { key: 'metricFindQuery', value: function metricFindQuery(
    query) {var _this9 = this;
      var result = void 0;
      var parts = [];

      // Split query. Query structure: group.host.app.item
      _lodash2.default.each(utils.splitTemplateQuery(query), function (part) {
        part = _this9.replaceTemplateVars(part, {});

        // Replace wildcard to regex
        if (part === '*') {
          part = '/.*/';
        }
        parts.push(part);
      });
      var template = _lodash2.default.zipObject(['group', 'host', 'app', 'item'], parts);

      // Get items
      if (parts.length === 4) {
        // Search for all items, even it's not belong to any application
        if (template.app === '/.*/') {
          template.app = '';
        }
        result = this.zabbix.getItems(template.group, template.host, template.app, template.item);
      } else if (parts.length === 3) {
        // Get applications
        result = this.zabbix.getApps(template.group, template.host, template.app);
      } else if (parts.length === 2) {
        // Get hosts
        result = this.zabbix.getHosts(template.group, template.host);
      } else if (parts.length === 1) {
        // Get groups
        result = this.zabbix.getGroups(template.group);
      } else {
        result = Promise.resolve([]);
      }

      return result.then(function (metrics) {
        return _lodash2.default.map(metrics, formatMetric);
      });
    }

    /////////////////
    // Annotations //
    /////////////////
  }, { key: 'annotationQuery', value: function annotationQuery(
    options) {var _this10 = this;
      var timeFrom = Math.ceil(dateMath.parse(options.rangeRaw.from) / 1000);
      var timeTo = Math.ceil(dateMath.parse(options.rangeRaw.to) / 1000);
      var annotation = options.annotation;
      var showOkEvents = annotation.showOkEvents ? c.SHOW_ALL_EVENTS : c.SHOW_OK_EVENTS;

      // Show all triggers
      var triggersOptions = {
        showTriggers: c.SHOW_ALL_TRIGGERS,
        hideHostsInMaintenance: false };


      var getTriggers = this.zabbix.getTriggers(this.replaceTemplateVars(annotation.group, {}),
      this.replaceTemplateVars(annotation.host, {}),
      this.replaceTemplateVars(annotation.application, {}),
      triggersOptions);

      return getTriggers.then(function (triggers) {

        // Filter triggers by description
        var triggerName = _this10.replaceTemplateVars(annotation.trigger, {});
        if (utils.isRegex(triggerName)) {
          triggers = _lodash2.default.filter(triggers, function (trigger) {
            return utils.buildRegex(triggerName).test(trigger.description);
          });
        } else if (triggerName) {
          triggers = _lodash2.default.filter(triggers, function (trigger) {
            return trigger.description === triggerName;
          });
        }

        // Remove events below the chose severity
        triggers = _lodash2.default.filter(triggers, function (trigger) {
          return Number(trigger.priority) >= Number(annotation.minseverity);
        });

        var objectids = _lodash2.default.map(triggers, 'triggerid');
        return _this10.zabbix.
        getEvents(objectids, timeFrom, timeTo, showOkEvents).
        then(function (events) {
          var indexedTriggers = _lodash2.default.keyBy(triggers, 'triggerid');

          // Hide acknowledged events if option enabled
          if (annotation.hideAcknowledged) {
            events = _lodash2.default.filter(events, function (event) {
              return !event.acknowledges.length;
            });
          }

          return _lodash2.default.map(events, function (event) {
            var tags = void 0;
            if (annotation.showHostname) {
              tags = _lodash2.default.map(event.hosts, 'name');
            }

            // Show event type (OK or Problem)
            var title = Number(event.value) ? 'Problem' : 'OK';

            var formatted_acknowledges = utils.formatAcknowledges(event.acknowledges);
            return {
              annotation: annotation,
              time: event.clock * 1000,
              title: title,
              tags: tags,
              text: indexedTriggers[event.objectid].description + formatted_acknowledges };

          });
        });
      });
    }

    /**
       * Get triggers and its details for panel's targets
       * Returns alert state ('ok' if no fired triggers, or 'alerting' if at least 1 trigger is fired)
       * or empty object if no related triggers are finded.
       */ }, { key: 'alertQuery', value: function alertQuery(
    options) {var _this11 = this;
      var enabled_targets = filterEnabledTargets(options.targets);
      var getPanelItems = _lodash2.default.map(enabled_targets, function (t) {
        var target = _lodash2.default.cloneDeep(t);
        _this11.replaceTargetVariables(target, options);
        return _this11.zabbix.getItemsFromTarget(target, { itemtype: 'num' });
      });

      return Promise.all(getPanelItems).
      then(function (results) {
        var items = _lodash2.default.flatten(results);
        var itemids = _lodash2.default.map(items, 'itemid');

        if (itemids.length === 0) {
          return [];
        }
        return _this11.zabbix.getAlerts(itemids);
      }).
      then(function (triggers) {
        triggers = _lodash2.default.filter(triggers, function (trigger) {
          return trigger.priority >= _this11.alertingMinSeverity;
        });

        if (!triggers || triggers.length === 0) {
          return {};
        }

        var state = 'ok';

        var firedTriggers = _lodash2.default.filter(triggers, { value: '1' });
        if (firedTriggers.length) {
          state = 'alerting';
        }

        var thresholds = _lodash2.default.map(triggers, function (trigger) {
          return getTriggerThreshold(trigger.expression);
        });

        return {
          panelId: options.panelId,
          state: state,
          thresholds: thresholds };

      });
    }

    // Replace template variables
  }, { key: 'replaceTargetVariables', value: function replaceTargetVariables(target, options) {var _this12 = this;
      var parts = ['group', 'host', 'application', 'item'];
      _lodash2.default.forEach(parts, function (p) {
        if (target[p] && target[p].filter) {
          target[p].filter = _this12.replaceTemplateVars(target[p].filter, options.scopedVars);
        }
      });
      target.textFilter = this.replaceTemplateVars(target.textFilter, options.scopedVars);

      _lodash2.default.forEach(target.functions, function (func) {
        func.params = _lodash2.default.map(func.params, function (param) {
          if (typeof param === 'number') {
            return +_this12.templateSrv.replace(param.toString(), options.scopedVars);
          } else {
            return _this12.templateSrv.replace(param, options.scopedVars);
          }
        });
      });
    } }, { key: 'isUseTrends', value: function isUseTrends(

    timeRange) {var _timeRange4 = _slicedToArray(
      timeRange, 2),timeFrom = _timeRange4[0],timeTo = _timeRange4[1];
      var useTrendsFrom = Math.ceil(dateMath.parse('now-' + this.trendsFrom) / 1000);
      var useTrendsRange = Math.ceil(utils.parseInterval(this.trendsRange) / 1000);
      var useTrends = this.trends && (
      timeFrom <= useTrendsFrom ||
      timeTo - timeFrom >= useTrendsRange);

      return useTrends;
    } }]);return ZabbixAPIDatasource;}();


function bindFunctionDefs(functionDefs, category) {
  var aggregationFunctions = _lodash2.default.map(metricFunctions.getCategories()[category], 'name');
  var aggFuncDefs = _lodash2.default.filter(functionDefs, function (func) {
    return _lodash2.default.includes(aggregationFunctions, func.def.name);
  });

  return _lodash2.default.map(aggFuncDefs, function (func) {
    var funcInstance = metricFunctions.createFuncInstance(func.def, func.params);
    return funcInstance.bindFunction(_dataProcessor2.default.metricFunctions);
  });
}

function getConsolidateBy(target) {
  var consolidateBy = 'avg';
  var funcDef = _lodash2.default.find(target.functions, function (func) {
    return func.def.name === 'consolidateBy';
  });
  if (funcDef && funcDef.params && funcDef.params.length) {
    consolidateBy = funcDef.params[0];
  }
  return consolidateBy;
}

function downsampleSeries(timeseries_data, options) {
  var defaultAgg = _dataProcessor2.default.aggregationFunctions['avg'];
  var consolidateByFunc = _dataProcessor2.default.aggregationFunctions[options.consolidateBy] || defaultAgg;
  return _lodash2.default.map(timeseries_data, function (timeseries) {
    if (timeseries.datapoints.length > options.maxDataPoints) {
      timeseries.datapoints = _dataProcessor2.default.
      groupBy(options.interval, consolidateByFunc, timeseries.datapoints);
    }
    return timeseries;
  });
}

function formatMetric(metricObj) {
  return {
    text: metricObj.name,
    expandable: false };

}

/**
   * Custom formatter for template variables.
   * Default Grafana "regex" formatter returns
   * value1|value2
   * This formatter returns
   * (value1|value2)
   * This format needed for using in complex regex with
   * template variables, for example
   * /CPU $cpu_item.*time/ where $cpu_item is system,user,iowait
   */
function zabbixTemplateFormat(value) {
  if (typeof value === 'string') {
    return utils.escapeRegex(value);
  }

  var escapedValues = _lodash2.default.map(value, utils.escapeRegex);
  return '(' + escapedValues.join('|') + ')';
}

function zabbixItemIdsTemplateFormat(value) {
  if (typeof value === 'string') {
    return value;
  }
  return value.join(',');
}

/**
   * If template variables are used in request, replace it using regex format
   * and wrap with '/' for proper multi-value work. Example:
   * $variable selected as a, b, c
   * We use filter $variable
   * $variable    -> a|b|c    -> /a|b|c/
   * /$variable/  -> /a|b|c/  -> /a|b|c/
   */
function replaceTemplateVars(templateSrv, target, scopedVars) {
  var replacedTarget = templateSrv.replace(target, scopedVars, zabbixTemplateFormat);
  if (target !== replacedTarget && !utils.isRegex(replacedTarget)) {
    replacedTarget = '/^' + replacedTarget + '$/';
  }
  return replacedTarget;
}

// Apply function one by one:
// sequence([a(), b(), c()]) = c(b(a()));
function sequence(funcsArray) {
  return function (result) {
    for (var i = 0; i < funcsArray.length; i++) {
      result = funcsArray[i].call(this, result);
    }
    return result;
  };
}

function filterEnabledTargets(targets) {
  return _lodash2.default.filter(targets, function (target) {
    return !(target.hide || !target.group || !target.host || !target.item);
  });
}

function getTriggerThreshold(expression) {
  var thresholdPattern = /.*[<>=]{1,2}([\d\.]+)/;
  var finded_thresholds = expression.match(thresholdPattern);
  if (finded_thresholds && finded_thresholds.length >= 2) {
    var threshold = finded_thresholds[1];
    threshold = Number(threshold);
    return threshold;
  } else {
    return null;
  }
}exports.

ZabbixAPIDatasource = ZabbixAPIDatasource;exports.zabbixTemplateFormat = zabbixTemplateFormat;

// Fix for backward compatibility with lodash 2.4
if (!_lodash2.default.includes) {_lodash2.default.includes = _lodash2.default.contains;}
if (!_lodash2.default.keyBy) {_lodash2.default.keyBy = _lodash2.default.indexBy;}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhdGFzb3VyY2UuanMiXSwibmFtZXMiOlsiZGF0ZU1hdGgiLCJ1dGlscyIsIm1pZ3JhdGlvbnMiLCJtZXRyaWNGdW5jdGlvbnMiLCJjIiwiWmFiYml4QVBJRGF0YXNvdXJjZSIsImluc3RhbmNlU2V0dGluZ3MiLCJ0ZW1wbGF0ZVNydiIsImFsZXJ0U3J2IiwiZGFzaGJvYXJkU3J2IiwiemFiYml4QWxlcnRpbmdTcnYiLCJaYWJiaXgiLCJyZXBsYWNlVGVtcGxhdGVWYXJzIiwiXyIsInBhcnRpYWwiLCJuYW1lIiwidXJsIiwiYmFzaWNBdXRoIiwid2l0aENyZWRlbnRpYWxzIiwianNvbkRhdGEiLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwidHJlbmRzIiwidHJlbmRzRnJvbSIsInRyZW5kc1JhbmdlIiwidHRsIiwiY2FjaGVUVEwiLCJwYXJzZUludGVydmFsIiwiYWxlcnRpbmdFbmFibGVkIiwiYWxlcnRpbmciLCJhZGRUaHJlc2hvbGRzIiwiYWxlcnRpbmdNaW5TZXZlcml0eSIsIlNFVl9XQVJOSU5HIiwiZGlzYWJsZVJlYWRPbmx5VXNlcnNBY2siLCJkYkNvbm5lY3Rpb25PcHRpb25zIiwiZGJDb25uZWN0aW9uIiwiZW5hYmxlRGlyZWN0REJDb25uZWN0aW9uIiwiZW5hYmxlIiwic3FsRGF0YXNvdXJjZUlkIiwiZGF0YXNvdXJjZUlkIiwiemFiYml4T3B0aW9ucyIsInphYmJpeCIsIm9wdGlvbnMiLCJhbGVydFF1ZXJ5IiwidGhlbiIsInNldFBhbmVsQWxlcnRTdGF0ZSIsInBhbmVsSWQiLCJhbGVydCIsInN0YXRlIiwicmVtb3ZlWmFiYml4VGhyZXNob2xkIiwiZm9yRWFjaCIsInRocmVzaG9sZHMiLCJzZXRQYW5lbFRocmVzaG9sZCIsInRocmVzaG9sZCIsInByb21pc2VzIiwibWFwIiwidGFyZ2V0cyIsInQiLCJoaWRlIiwidGltZUZyb20iLCJNYXRoIiwiY2VpbCIsInBhcnNlIiwicmFuZ2UiLCJmcm9tIiwidGltZVRvIiwidG8iLCJ0YXJnZXQiLCJjbG9uZURlZXAiLCJyZXBsYWNlVGFyZ2V0VmFyaWFibGVzIiwidGltZUZ1bmN0aW9ucyIsImJpbmRGdW5jdGlvbkRlZnMiLCJmdW5jdGlvbnMiLCJsZW5ndGgiLCJzZXF1ZW5jZSIsInRpbWVfZnJvbSIsInRpbWVfdG8iLCJ0aW1lUmFuZ2UiLCJ1c2VUcmVuZHMiLCJpc1VzZVRyZW5kcyIsIm1vZGUiLCJNT0RFX01FVFJJQ1MiLCJNT0RFX1RFWFQiLCJtaWdyYXRlIiwiZ3JvdXAiLCJob3N0IiwiaXRlbSIsInF1ZXJ5TnVtZXJpY0RhdGEiLCJxdWVyeVRleHREYXRhIiwiTU9ERV9JVEVNSUQiLCJpdGVtaWRzIiwicXVlcnlJdGVtSWREYXRhIiwiTU9ERV9JVFNFUlZJQ0UiLCJxdWVyeUlUU2VydmljZURhdGEiLCJNT0RFX1RSSUdHRVJTIiwicXVlcnlUcmlnZ2Vyc0RhdGEiLCJQcm9taXNlIiwiYWxsIiwiZmxhdHRlbiIsImRhdGEiLCJnZXRJdGVtT3B0aW9ucyIsIml0ZW10eXBlIiwiZ2V0SXRlbXNGcm9tVGFyZ2V0IiwicXVlcnlOdW1lcmljRGF0YUZvckl0ZW1zIiwiaXRlbXMiLCJnZXRIaXN0b3J5UHJvbWlzZSIsImNvbnNvbGlkYXRlQnkiLCJnZXRDb25zb2xpZGF0ZUJ5IiwiZ2V0VHJlbmRzREIiLCJkYkNvbm5lY3RvciIsImhhbmRsZUdyYWZhbmFUU1Jlc3BvbnNlIiwiaGlzdG9yeSIsInZhbHVlVHlwZSIsImdldFRyZW5kVmFsdWVUeXBlIiwiZ2V0VHJlbmQiLCJyZXNwb25zZUhhbmRsZXIiLCJoYW5kbGVUcmVuZHMiLCJ0aW1lc2VyaWVzIiwic2VyaWVzIiwiZGF0YXBvaW50cyIsInNvcnRCeSIsInBvaW50IiwiREFUQVBPSU5UX1RTIiwiZ2V0SGlzdG9yeURCIiwiZ2V0SGlzdG9yeSIsImxpbWl0IiwiaGFuZGxlSGlzdG9yeSIsImFwcGx5RGF0YVByb2Nlc3NpbmdGdW5jdGlvbnMiLCJkb3duc2FtcGxlU2VyaWVzIiwidHJlbmRGdW5jdGlvbnMiLCJnZXRDYXRlZ29yaWVzIiwidHJlbmRWYWx1ZUZ1bmMiLCJmaW5kIiwiaW5jbHVkZXMiLCJmdW5jIiwiZGVmIiwicGFyYW1zIiwidGltZXNlcmllc19kYXRhIiwidHJhbnNmb3JtRnVuY3Rpb25zIiwiYWdncmVnYXRpb25GdW5jdGlvbnMiLCJmaWx0ZXJGdW5jdGlvbnMiLCJhbGlhc0Z1bmN0aW9ucyIsImRwIiwiYWdnRnVuY05hbWVzIiwibGFzdEFnZyIsImZpbmRMYXN0IiwidGV4dCIsImFwcGx5VGltZVNoaWZ0RnVuY3Rpb24iLCJ0aW1lU2hpZnRGdW5jIiwic2hpZnQiLCJkYXRhUHJvY2Vzc29yIiwidW5TaGlmdFRpbWVTZXJpZXMiLCJyZXN1bHRGb3JtYXQiLCJoYW5kbGVIaXN0b3J5QXNUYWJsZSIsImhhbmRsZVRleHQiLCJyZXNvbHZlIiwicmVwbGFjZSIsInNjb3BlZFZhcnMiLCJ6YWJiaXhJdGVtSWRzVGVtcGxhdGVGb3JtYXQiLCJzcGxpdCIsIml0ZW1pZCIsInRyaW0iLCJnZXRJdGVtc0J5SURzIiwiaXRzZXJ2aWNlIiwiaXRTZXJ2aWNlRmlsdGVyIiwic2xhUHJvcGVydHkiLCJpdFNlcnZpY2VJZHMiLCJpdFNlcnZpY2VzIiwiaXNPbGRWZXJzaW9uIiwiZ2V0SVRTZXJ2aWNlcyIsIml0c2VydmljZXMiLCJmaWx0ZXIiLCJzZXJ2aWNlaWQiLCJnZXRTTEEiLCJzZXJ2aWNlaWRzIiwiaGFuZGxlU0xBUmVzcG9uc2UiLCJzbGFSZXNwb25zZSIsImdldEhvc3RzRnJvbVRhcmdldCIsInJlc3VsdHMiLCJob3N0cyIsImFwcHMiLCJob3N0aWRzIiwiYXBwaWRzIiwibWluU2V2ZXJpdHkiLCJ0cmlnZ2VycyIsImFja25vd2xlZGdlZCIsImNvdW50IiwiZ2V0SG9zdEFsZXJ0cyIsImhhbmRsZVRyaWdnZXJzUmVzcG9uc2UiLCJ6YWJiaXhWZXJzaW9uIiwiZ2V0VmVyc2lvbiIsInZlcnNpb24iLCJsb2dpbiIsInRlc3RTUUxEYXRhU291cmNlIiwic3RhdHVzIiwidGl0bGUiLCJtZXNzYWdlIiwiY2F0Y2giLCJlcnJvciIsIlphYmJpeEFQSUVycm9yIiwicXVlcnkiLCJyZXN1bHQiLCJwYXJ0cyIsImVhY2giLCJzcGxpdFRlbXBsYXRlUXVlcnkiLCJwYXJ0IiwicHVzaCIsInRlbXBsYXRlIiwiemlwT2JqZWN0IiwiYXBwIiwiZ2V0SXRlbXMiLCJnZXRBcHBzIiwiZ2V0SG9zdHMiLCJnZXRHcm91cHMiLCJtZXRyaWNzIiwiZm9ybWF0TWV0cmljIiwicmFuZ2VSYXciLCJhbm5vdGF0aW9uIiwic2hvd09rRXZlbnRzIiwiU0hPV19BTExfRVZFTlRTIiwiU0hPV19PS19FVkVOVFMiLCJ0cmlnZ2Vyc09wdGlvbnMiLCJzaG93VHJpZ2dlcnMiLCJTSE9XX0FMTF9UUklHR0VSUyIsImhpZGVIb3N0c0luTWFpbnRlbmFuY2UiLCJnZXRUcmlnZ2VycyIsImFwcGxpY2F0aW9uIiwidHJpZ2dlck5hbWUiLCJ0cmlnZ2VyIiwiaXNSZWdleCIsImJ1aWxkUmVnZXgiLCJ0ZXN0IiwiZGVzY3JpcHRpb24iLCJOdW1iZXIiLCJwcmlvcml0eSIsIm1pbnNldmVyaXR5Iiwib2JqZWN0aWRzIiwiZ2V0RXZlbnRzIiwiaW5kZXhlZFRyaWdnZXJzIiwia2V5QnkiLCJoaWRlQWNrbm93bGVkZ2VkIiwiZXZlbnRzIiwiZXZlbnQiLCJhY2tub3dsZWRnZXMiLCJ0YWdzIiwic2hvd0hvc3RuYW1lIiwidmFsdWUiLCJmb3JtYXR0ZWRfYWNrbm93bGVkZ2VzIiwiZm9ybWF0QWNrbm93bGVkZ2VzIiwidGltZSIsImNsb2NrIiwib2JqZWN0aWQiLCJlbmFibGVkX3RhcmdldHMiLCJmaWx0ZXJFbmFibGVkVGFyZ2V0cyIsImdldFBhbmVsSXRlbXMiLCJnZXRBbGVydHMiLCJmaXJlZFRyaWdnZXJzIiwiZ2V0VHJpZ2dlclRocmVzaG9sZCIsImV4cHJlc3Npb24iLCJwIiwidGV4dEZpbHRlciIsInBhcmFtIiwidG9TdHJpbmciLCJ1c2VUcmVuZHNGcm9tIiwidXNlVHJlbmRzUmFuZ2UiLCJmdW5jdGlvbkRlZnMiLCJjYXRlZ29yeSIsImFnZ0Z1bmNEZWZzIiwiZnVuY0luc3RhbmNlIiwiY3JlYXRlRnVuY0luc3RhbmNlIiwiYmluZEZ1bmN0aW9uIiwiZnVuY0RlZiIsImRlZmF1bHRBZ2ciLCJjb25zb2xpZGF0ZUJ5RnVuYyIsIm1heERhdGFQb2ludHMiLCJncm91cEJ5IiwiaW50ZXJ2YWwiLCJtZXRyaWNPYmoiLCJleHBhbmRhYmxlIiwiemFiYml4VGVtcGxhdGVGb3JtYXQiLCJlc2NhcGVSZWdleCIsImVzY2FwZWRWYWx1ZXMiLCJqb2luIiwicmVwbGFjZWRUYXJnZXQiLCJmdW5jc0FycmF5IiwiaSIsImNhbGwiLCJ0aHJlc2hvbGRQYXR0ZXJuIiwiZmluZGVkX3RocmVzaG9sZHMiLCJtYXRjaCIsImNvbnRhaW5zIiwiaW5kZXhCeSJdLCJtYXBwaW5ncyI6Iit5Q0FBQSxnQztBQUNBLG1ELElBQVlBLFE7QUFDWixnQyxJQUFZQyxLO0FBQ1osMEMsSUFBWUMsVTtBQUNaLG9ELElBQVlDLGU7QUFDWix3QyxJQUFZQyxDO0FBQ1osZ0Q7QUFDQSxvRDtBQUNBO0FBQ0E7QUFDQSxrRTs7QUFFTUMsbUI7O0FBRUo7QUFDQSwrQkFBWUMsZ0JBQVosRUFBOEJDLFdBQTlCLEVBQTJDQyxRQUEzQyxFQUFxREMsWUFBckQsRUFBbUVDLGlCQUFuRSxFQUFzRkMsTUFBdEYsRUFBOEY7QUFDNUYsU0FBS0osV0FBTCxHQUFtQkEsV0FBbkI7QUFDQSxTQUFLQyxRQUFMLEdBQWdCQSxRQUFoQjtBQUNBLFNBQUtDLFlBQUwsR0FBb0JBLFlBQXBCO0FBQ0EsU0FBS0MsaUJBQUwsR0FBeUJBLGlCQUF6Qjs7QUFFQTtBQUNBLFNBQUtFLG1CQUFMLEdBQTJCQyxpQkFBRUMsT0FBRixDQUFVRixtQkFBVixFQUErQixLQUFLTCxXQUFwQyxDQUEzQjs7QUFFQTtBQUNBLFNBQUtRLElBQUwsR0FBd0JULGlCQUFpQlMsSUFBekM7QUFDQSxTQUFLQyxHQUFMLEdBQXdCVixpQkFBaUJVLEdBQXpDO0FBQ0EsU0FBS0MsU0FBTCxHQUF3QlgsaUJBQWlCVyxTQUF6QztBQUNBLFNBQUtDLGVBQUwsR0FBd0JaLGlCQUFpQlks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bkIsRUFBeUJyRixNQUF6QixDQUFUO0FBQ0Q7QUFDRCxXQUFPQSxNQUFQO0FBQ0QsR0FMRDtBQU1EOztBQUVELFNBQVNvRCxvQkFBVCxDQUE4QnJNLE9BQTlCLEVBQXVDO0FBQ3JDLFNBQU8zQyxpQkFBRThKLE1BQUYsQ0FBU25ILE9BQVQsRUFBa0Isa0JBQVU7QUFDakMsV0FBTyxFQUFFVyxPQUFPVCxJQUFQLElBQWUsQ0FBQ1MsT0FBT2lCLEtBQXZCLElBQWdDLENBQUNqQixPQUFPa0IsSUFBeEMsSUFBZ0QsQ0FBQ2xCLE9BQU9tQixJQUExRCxDQUFQO0FBQ0QsR0FGTSxDQUFQO0FBR0Q7O0FBRUQsU0FBUzJLLG1CQUFULENBQTZCQyxVQUE3QixFQUF5QztBQUN2QyxNQUFJNkIsbUJBQW1CLHVCQUF2QjtBQUNBLE1BQUlDLG9CQUFvQjlCLFdBQVcrQixLQUFYLENBQWlCRixnQkFBakIsQ0FBeEI7QUFDQSxNQUFJQyxxQkFBcUJBLGtCQUFrQnZOLE1BQWxCLElBQTRCLENBQXJELEVBQXdEO0FBQ3RELFFBQUlwQixZQUFZMk8sa0JBQWtCLENBQWxCLENBQWhCO0FBQ0EzTyxnQkFBWW9MLE9BQU9wTCxTQUFQLENBQVo7QUFDQSxXQUFPQSxTQUFQO0FBQ0QsR0FKRCxNQUlPO0FBQ0wsV0FBTyxJQUFQO0FBQ0Q7QUFDRixDOztBQUVPaEQsbUIsR0FBQUEsbUIsU0FBcUJrUixvQixHQUFBQSxvQjs7QUFFN0I7QUFDQSxJQUFJLENBQUMxUSxpQkFBRXdILFFBQVAsRUFBaUIsQ0FBQ3hILGlCQUFFd0gsUUFBRixHQUFheEgsaUJBQUVxUixRQUFmLENBQXlCO0FBQzNDLElBQUksQ0FBQ3JSLGlCQUFFa08sS0FBUCxFQUFjLENBQUNsTyxpQkFBRWtPLEtBQUYsR0FBVWxPLGlCQUFFc1IsT0FBWixDQUFxQiIsImZpbGUiOiJkYXRhc291cmNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCAqIGFzIGRhdGVNYXRoIGZyb20gJ2FwcC9jb3JlL3V0aWxzL2RhdGVtYXRoJztcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0ICogYXMgbWlncmF0aW9ucyBmcm9tICcuL21pZ3JhdGlvbnMnO1xuaW1wb3J0ICogYXMgbWV0cmljRnVuY3Rpb25zIGZyb20gJy4vbWV0cmljRnVuY3Rpb25zJztcbmltcG9ydCAqIGFzIGMgZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0IGRhdGFQcm9jZXNzb3IgZnJvbSAnLi9kYXRhUHJvY2Vzc29yJztcbmltcG9ydCByZXNwb25zZUhhbmRsZXIgZnJvbSAnLi9yZXNwb25zZUhhbmRsZXInO1xuaW1wb3J0ICcuL3phYmJpeC5qcyc7XG5pbXBvcnQgJy4vemFiYml4QWxlcnRpbmcuc2VydmljZS5qcyc7XG5pbXBvcnQge1phYmJpeEFQSUVycm9yfSBmcm9tICcuL3phYmJpeEFQSUNvcmUuc2VydmljZS5qcyc7XG5cbmNsYXNzIFphYmJpeEFQSURhdGFzb3VyY2Uge1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgY29uc3RydWN0b3IoaW5zdGFuY2VTZXR0aW5ncywgdGVtcGxhdGVTcnYsIGFsZXJ0U3J2LCBkYXNoYm9hcmRTcnYsIHphYmJpeEFsZXJ0aW5nU3J2LCBaYWJiaXgpIHtcbiAgICB0aGlzLnRlbXBsYXRlU3J2ID0gdGVtcGxhdGVTcnY7XG4gICAgdGhpcy5hbGVydFNydiA9IGFsZXJ0U3J2O1xuICAgIHRoaXMuZGFzaGJvYXJkU3J2ID0gZGFzaGJvYXJkU3J2O1xuICAgIHRoaXMuemFiYml4QWxlcnRpbmdTcnYgPSB6YWJiaXhBbGVydGluZ1NydjtcblxuICAgIC8vIFVzZSBjdXN0b20gZm9ybWF0IGZvciB0ZW1wbGF0ZSB2YXJpYWJsZXNcbiAgICB0aGlzLnJlcGxhY2VUZW1wbGF0ZVZhcnMgPSBfLnBhcnRpYWwocmVwbGFjZVRlbXBsYXRlVmFycywgdGhpcy50ZW1wbGF0ZVNydik7XG5cbiAgICAvLyBHZW5lcmFsIGRhdGEgc291cmNlIHNldHRpbmdzXG4gICAgdGhpcy5uYW1lICAgICAgICAgICAgID0gaW5zdGFuY2VTZXR0aW5ncy5uYW1lO1xuICAgIHRoaXMudXJsICAgICAgICAgICAgICA9IGluc3RhbmNlU2V0dGluZ3MudXJsO1xuICAgIHRoaXMuYmFzaWNBdXRoICAgICAgICA9IGluc3RhbmNlU2V0dGluZ3MuYmFzaWNBdXRoO1xuICAgIHRoaXMud2l0aENyZWRlbnRpYWxzICA9IGluc3RhbmNlU2V0dGluZ3Mud2l0aENyZWRlbnRpYWxzO1xuXG4gICAgY29uc3QganNvbkRhdGEgPSBpbnN0YW5jZVNldHRpbmdzLmpzb25EYXRhIHx8IHt9O1xuXG4gICAgLy8gWmFiYml4IEFQSSBjcmVkZW50aWFsc1xuICAgIHRoaXMudXNlcm5hbWUgICAgICAgICA9IGpzb25EYXRhLnVzZXJuYW1lO1xuICAgIHRoaXMucGFzc3dvcmQgICAgICAgICA9IGpzb25EYXRhLnBhc3N3b3JkO1xuXG4gICAgLy8gVXNlIHRyZW5kcyBpbnN0ZWFkIGhpc3Rvcnkgc2luY2Ugc3BlY2lmaWVkIHRpbWVcbiAgICB0aGlzLnRyZW5kcyAgICAgICAgICAgPSBqc29uRGF0YS50cmVuZHM7XG4gICAgdGhpcy50cmVuZHNGcm9tICAgICAgID0ganNvbkRhdGEudHJlbmRzRnJvbSB8fCAnN2QnO1xuICAgIHRoaXMudHJlbmRzUmFuZ2UgICAgICA9IGpzb25EYXRhLnRyZW5kc1JhbmdlIHx8ICc0ZCc7XG5cbiAgICAvLyBTZXQgY2FjaGUgdXBkYXRlIGludGVydmFsXG4gICAgdmFyIHR0bCA9IGpzb25EYXRhLmNhY2hlVFRMIHx8ICcxaCc7XG4gICAgdGhpcy5jYWNoZVRUTCA9IHV0aWxzLnBhcnNlSW50ZXJ2YWwodHRsKTtcblxuICAgIC8vIEFsZXJ0aW5nIG9wdGlvbnNcbiAgICB0aGlzLmFsZXJ0aW5nRW5hYmxlZCA9ICAgICBqc29uRGF0YS5hbGVydGluZztcbiAgICB0aGlzLmFkZFRocmVzaG9sZHMgPSAgICAgICBqc29uRGF0YS5hZGRUaHJlc2hvbGRzO1xuICAgIHRoaXMuYWxlcnRpbmdNaW5TZXZlcml0eSA9IGpzb25EYXRhLmFsZXJ0aW5nTWluU2V2ZXJpdHkgfHwgYy5TRVZfV0FSTklORztcblxuICAgIC8vIE90aGVyIG9wdGlvbnNcbiAgICB0aGlzLmRpc2FibGVSZWFkT25seVVzZXJzQWNrID0ganNvbkRhdGEuZGlzYWJsZVJlYWRPbmx5VXNlcnNBY2s7XG5cbiAgICAvLyBEaXJlY3QgREIgQ29ubmVjdGlvbiBvcHRpb25zXG4gICAgbGV0IGRiQ29ubmVjdGlvbk9wdGlvbnMgPSBqc29uRGF0YS5kYkNvbm5lY3Rpb24gfHwge307XG4gICAgdGhpcy5lbmFibGVEaXJlY3REQkNvbm5lY3Rpb24gPSBkYkNvbm5lY3Rpb25PcHRpb25zLmVuYWJsZTtcbiAgICB0aGlzLnNxbERhdGFzb3VyY2VJZCA9IGRiQ29ubmVjdGlvbk9wdGlvbnMuZGF0YXNvdXJjZUlkO1xuXG4gICAgbGV0IHphYmJpeE9wdGlvbnMgPSB7XG4gICAgICB1c2VybmFtZTogdGhpcy51c2VybmFtZSxcbiAgICAgIHBhc3N3b3JkOiB0aGlzLnBhc3N3b3JkLFxuICAgICAgYmFzaWNBdXRoOiB0aGlzLmJhc2ljQXV0aCxcbiAgICAgIHdpdGhDcmVkZW50aWFsczogdGhpcy53aXRoQ3JlZGVudGlhbHMsXG4gICAgICBjYWNoZVRUTDogdGhpcy5jYWNoZVRUTCxcbiAgICAgIGVuYWJsZURpcmVjdERCQ29ubmVjdGlvbjogdGhpcy5lbmFibGVEaXJlY3REQkNvbm5lY3Rpb24sXG4gICAgICBzcWxEYXRhc291cmNlSWQ6IHRoaXMuc3FsRGF0YXNvdXJjZUlkXG4gICAgfTtcblxuICAgIHRoaXMuemFiYml4ID0gbmV3IFphYmJpeCh0aGlzLnVybCwgemFiYml4T3B0aW9ucyk7XG4gIH1cblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgLy8gRGF0YXNvdXJjZSBtZXRob2RzIC8vXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIC8qKlxuICAgKiBRdWVyeSBwYW5lbCBkYXRhLiBDYWxscyBmb3IgZWFjaCBwYW5lbCBpbiBkYXNoYm9hcmQuXG4gICAqIEBwYXJhbSAge09iamVjdH0gb3B0aW9ucyAgIENvbnRhaW5zIHRpbWUgcmFuZ2UsIHRhcmdldHMgYW5kIG90aGVyIGluZm8uXG4gICAqIEByZXR1cm4ge09iamVjdH0gR3JhZmFuYSBtZXRyaWNzIG9iamVjdCB3aXRoIHRpbWVzZXJpZXMgZGF0YSBmb3IgZWFjaCB0YXJnZXQuXG4gICAqL1xuICBxdWVyeShvcHRpb25zKSB7XG4gICAgLy8gR2V0IGFsZXJ0cyBmb3IgY3VycmVudCBwYW5lbFxuICAgIGlmICh0aGlzLmFsZXJ0aW5nRW5hYmxlZCkge1xuICAgICAgdGhpcy5hbGVydFF1ZXJ5KG9wdGlvbnMpLnRoZW4oYWxlcnQgPT4ge1xuICAgICAgICB0aGlzLnphYmJpeEFsZXJ0aW5nU3J2LnNldFBhbmVsQWxlcnRTdGF0ZShvcHRpb25zLnBhbmVsSWQsIGFsZXJ0LnN0YXRlKTtcblxuICAgICAgICB0aGlzLnphYmJpeEFsZXJ0aW5nU3J2LnJlbW92ZVphYmJpeFRocmVzaG9sZChvcHRpb25zLnBhbmVsSWQpO1xuICAgICAgICBpZiAodGhpcy5hZGRUaHJlc2hvbGRzKSB7XG4gICAgICAgICAgXy5mb3JFYWNoKGFsZXJ0LnRocmVzaG9sZHMsIHRocmVzaG9sZCA9PiB7XG4gICAgICAgICAgICB0aGlzLnphYmJpeEFsZXJ0aW5nU3J2LnNldFBhbmVsVGhyZXNob2xkKG9wdGlvbnMucGFuZWxJZCwgdGhyZXNob2xkKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIHJlcXVlc3QgZm9yIGVhY2ggdGFyZ2V0XG4gICAgbGV0IHByb21pc2VzID0gXy5tYXAob3B0aW9ucy50YXJnZXRzLCB0ID0+IHtcbiAgICAgIC8vIERvbid0IHJlcXVlc3QgdW5kZWZpbmVkIGFuZCBoaWRkZW4gdGFyZ2V0c1xuICAgICAgaWYgKHQuaGlkZSkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG5cbiAgICAgIGxldCB0aW1lRnJvbSA9IE1hdGguY2VpbChkYXRlTWF0aC5wYXJzZShvcHRpb25zLnJhbmdlLmZyb20pIC8gMTAwMCk7XG4gICAgICBsZXQgdGltZVRvID0gTWF0aC5jZWlsKGRhdGVNYXRoLnBhcnNlKG9wdGlvbnMucmFuZ2UudG8pIC8gMTAwMCk7XG5cbiAgICAgIC8vIFByZXZlbnQgY2hhbmdlcyBvZiBvcmlnaW5hbCBvYmplY3RcbiAgICAgIGxldCB0YXJnZXQgPSBfLmNsb25lRGVlcCh0KTtcbiAgICAgIHRoaXMucmVwbGFjZVRhcmdldFZhcmlhYmxlcyh0YXJnZXQsIG9wdGlvbnMpO1xuXG4gICAgICAvLyBBcHBseSBUaW1lLXJlbGF0ZWQgZnVuY3Rpb25zICh0aW1lU2hpZnQoKSwgZXRjKVxuICAgICAgbGV0IHRpbWVGdW5jdGlvbnMgPSBiaW5kRnVuY3Rpb25EZWZzKHRhcmdldC5mdW5jdGlvbnMsICdUaW1lJyk7XG4gICAgICBpZiAodGltZUZ1bmN0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgW3RpbWVfZnJvbSwgdGltZV90b10gPSBzZXF1ZW5jZSh0aW1lRnVuY3Rpb25zKShbdGltZUZyb20sIHRpbWVUb10pO1xuICAgICAgICB0aW1lRnJvbSA9IHRpbWVfZnJvbTtcbiAgICAgICAgdGltZVRvID0gdGltZV90bztcbiAgICAgIH1cbiAgICAgIGxldCB0aW1lUmFuZ2UgPSBbdGltZUZyb20sIHRpbWVUb107XG5cbiAgICAgIGxldCB1c2VUcmVuZHMgPSB0aGlzLmlzVXNlVHJlbmRzKHRpbWVSYW5nZSk7XG5cbiAgICAgIC8vIE1ldHJpY3Mgb3IgVGV4dCBxdWVyeSBtb2RlXG4gICAgICBpZiAoIXRhcmdldC5tb2RlIHx8IHRhcmdldC5tb2RlID09PSBjLk1PREVfTUVUUklDUyB8fCB0YXJnZXQubW9kZSA9PT0gYy5NT0RFX1RFWFQpIHtcbiAgICAgICAgLy8gTWlncmF0ZSBvbGQgdGFyZ2V0c1xuICAgICAgICB0YXJnZXQgPSBtaWdyYXRpb25zLm1pZ3JhdGUodGFyZ2V0KTtcblxuICAgICAgICAvLyBEb24ndCByZXF1ZXN0IHVuZGVmaW5lZCBhbmQgaGlkZGVuIHRhcmdldHNcbiAgICAgICAgaWYgKHRhcmdldC5oaWRlIHx8ICF0YXJnZXQuZ3JvdXAgfHwgIXRhcmdldC5ob3N0IHx8ICF0YXJnZXQuaXRlbSkge1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGFyZ2V0Lm1vZGUgfHwgdGFyZ2V0Lm1vZGUgPT09IGMuTU9ERV9NRVRSSUNTKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMucXVlcnlOdW1lcmljRGF0YSh0YXJnZXQsIHRpbWVSYW5nZSwgdXNlVHJlbmRzLCBvcHRpb25zKTtcbiAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQubW9kZSA9PT0gYy5NT0RFX1RFWFQpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5xdWVyeVRleHREYXRhKHRhcmdldCwgdGltZVJhbmdlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0YXJnZXQubW9kZSA9PT0gYy5NT0RFX0lURU1JRCkge1xuICAgICAgICAvLyBJdGVtIElEIG1vZGVcbiAgICAgICAgaWYgKCF0YXJnZXQuaXRlbWlkcykge1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5xdWVyeUl0ZW1JZERhdGEodGFyZ2V0LCB0aW1lUmFuZ2UsIHVzZVRyZW5kcywgb3B0aW9ucyk7XG4gICAgICB9IGVsc2UgaWYgKHRhcmdldC5tb2RlID09PSBjLk1PREVfSVRTRVJWSUNFKSB7XG4gICAgICAgIC8vIElUIHNlcnZpY2VzIG1vZGVcbiAgICAgICAgcmV0dXJuIHRoaXMucXVlcnlJVFNlcnZpY2VEYXRhKHRhcmdldCwgdGltZVJhbmdlLCBvcHRpb25zKTtcbiAgICAgIH0gZWxzZSBpZiAodGFyZ2V0Lm1vZGUgPT09IGMuTU9ERV9UUklHR0VSUykge1xuICAgICAgICAvLyBUcmlnZ2VycyBtb2RlXG4gICAgICAgIHJldHVybiB0aGlzLnF1ZXJ5VHJpZ2dlcnNEYXRhKHRhcmdldCwgdGltZVJhbmdlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIERhdGEgZm9yIHBhbmVsIChhbGwgdGFyZ2V0cylcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoXy5mbGF0dGVuKHByb21pc2VzKSlcbiAgICAgIC50aGVuKF8uZmxhdHRlbilcbiAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICByZXR1cm4geyBkYXRhOiBkYXRhIH07XG4gICAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBRdWVyeSB0YXJnZXQgZGF0YSBmb3IgTWV0cmljcyBtb2RlXG4gICAqL1xuICBxdWVyeU51bWVyaWNEYXRhKHRhcmdldCwgdGltZVJhbmdlLCB1c2VUcmVuZHMsIG9wdGlvbnMpIHtcbiAgICBsZXQgZ2V0SXRlbU9wdGlvbnMgPSB7XG4gICAgICBpdGVtdHlwZTogJ251bSdcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLnphYmJpeC5nZXRJdGVtc0Zyb21UYXJnZXQodGFyZ2V0LCBnZXRJdGVtT3B0aW9ucylcbiAgICAudGhlbihpdGVtcyA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5xdWVyeU51bWVyaWNEYXRhRm9ySXRlbXMoaXRlbXMsIHRhcmdldCwgdGltZVJhbmdlLCB1c2VUcmVuZHMsIG9wdGlvbnMpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFF1ZXJ5IGhpc3RvcnkgZm9yIG51bWVyaWMgaXRlbXNcbiAgICovXG4gIHF1ZXJ5TnVtZXJpY0RhdGFGb3JJdGVtcyhpdGVtcywgdGFyZ2V0LCB0aW1lUmFuZ2UsIHVzZVRyZW5kcywgb3B0aW9ucykge1xuICAgIGxldCBbdGltZUZyb20sIHRpbWVUb10gPSB0aW1lUmFuZ2U7XG4gICAgbGV0IGdldEhpc3RvcnlQcm9taXNlO1xuICAgIG9wdGlvbnMuY29uc29saWRhdGVCeSA9IGdldENvbnNvbGlkYXRlQnkodGFyZ2V0KTtcblxuICAgIGlmICh1c2VUcmVuZHMpIHtcbiAgICAgIGlmICh0aGlzLmVuYWJsZURpcmVjdERCQ29ubmVjdGlvbikge1xuICAgICAgICBnZXRIaXN0b3J5UHJvbWlzZSA9IHRoaXMuemFiYml4LmdldFRyZW5kc0RCKGl0ZW1zLCB0aW1lRnJvbSwgdGltZVRvLCBvcHRpb25zKVxuICAgICAgICAudGhlbihoaXN0b3J5ID0+IHRoaXMuemFiYml4LmRiQ29ubmVjdG9yLmhhbmRsZUdyYWZhbmFUU1Jlc3BvbnNlKGhpc3RvcnksIGl0ZW1zKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgdmFsdWVUeXBlID0gdGhpcy5nZXRUcmVuZFZhbHVlVHlwZSh0YXJnZXQpO1xuICAgICAgICBnZXRIaXN0b3J5UHJvbWlzZSA9IHRoaXMuemFiYml4LmdldFRyZW5kKGl0ZW1zLCB0aW1lRnJvbSwgdGltZVRvKVxuICAgICAgICAudGhlbihoaXN0b3J5ID0+IHJlc3BvbnNlSGFuZGxlci5oYW5kbGVUcmVuZHMoaGlzdG9yeSwgaXRlbXMsIHZhbHVlVHlwZSkpXG4gICAgICAgIC50aGVuKHRpbWVzZXJpZXMgPT4ge1xuICAgICAgICAgIC8vIFNvcnQgdHJlbmQgZGF0YSwgaXNzdWUgIzIwMlxuICAgICAgICAgIF8uZm9yRWFjaCh0aW1lc2VyaWVzLCBzZXJpZXMgPT4ge1xuICAgICAgICAgICAgc2VyaWVzLmRhdGFwb2ludHMgPSBfLnNvcnRCeShzZXJpZXMuZGF0YXBvaW50cywgcG9pbnQgPT4gcG9pbnRbYy5EQVRBUE9JTlRfVFNdKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gdGltZXNlcmllcztcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFVzZSBoaXN0b3J5XG4gICAgICBpZiAodGhpcy5lbmFibGVEaXJlY3REQkNvbm5lY3Rpb24pIHtcbiAgICAgICAgZ2V0SGlzdG9yeVByb21pc2UgPSB0aGlzLnphYmJpeC5nZXRIaXN0b3J5REIoaXRlbXMsIHRpbWVGcm9tLCB0aW1lVG8sIG9wdGlvbnMpXG4gICAgICAgIC50aGVuKGhpc3RvcnkgPT4gdGhpcy56YWJiaXguZGJDb25uZWN0b3IuaGFuZGxlR3JhZmFuYVRTUmVzcG9uc2UoaGlzdG9yeSwgaXRlbXMpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGdldEhpc3RvcnlQcm9taXNlID0gdGhpcy56YWJiaXguZ2V0SGlzdG9yeShpdGVtcywgdGltZUZyb20sIHRpbWVUbywgdGFyZ2V0LmxpbWl0KVxuICAgICAgICAudGhlbihoaXN0b3J5ID0+IHJlc3BvbnNlSGFuZGxlci5oYW5kbGVIaXN0b3J5KGhpc3RvcnksIGl0ZW1zKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGdldEhpc3RvcnlQcm9taXNlXG4gICAgLnRoZW4odGltZXNlcmllcyA9PiB0aGlzLmFwcGx5RGF0YVByb2Nlc3NpbmdGdW5jdGlvbnModGltZXNlcmllcywgdGFyZ2V0KSlcbiAgICAudGhlbih0aW1lc2VyaWVzID0+IGRvd25zYW1wbGVTZXJpZXModGltZXNlcmllcywgb3B0aW9ucykpO1xuICB9XG5cbiAgZ2V0VHJlbmRWYWx1ZVR5cGUodGFyZ2V0KSB7XG4gICAgLy8gRmluZCB0cmVuZFZhbHVlKCkgZnVuY3Rpb24gYW5kIGdldCBzcGVjaWZpZWQgdHJlbmQgdmFsdWVcbiAgICB2YXIgdHJlbmRGdW5jdGlvbnMgPSBfLm1hcChtZXRyaWNGdW5jdGlvbnMuZ2V0Q2F0ZWdvcmllcygpWydUcmVuZHMnXSwgJ25hbWUnKTtcbiAgICB2YXIgdHJlbmRWYWx1ZUZ1bmMgPSBfLmZpbmQodGFyZ2V0LmZ1bmN0aW9ucywgZnVuYyA9PiB7XG4gICAgICByZXR1cm4gXy5pbmNsdWRlcyh0cmVuZEZ1bmN0aW9ucywgZnVuYy5kZWYubmFtZSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRyZW5kVmFsdWVGdW5jID8gdHJlbmRWYWx1ZUZ1bmMucGFyYW1zWzBdIDogXCJhdmdcIjtcbiAgfVxuXG4gIGFwcGx5RGF0YVByb2Nlc3NpbmdGdW5jdGlvbnModGltZXNlcmllc19kYXRhLCB0YXJnZXQpIHtcbiAgICBsZXQgdHJhbnNmb3JtRnVuY3Rpb25zICAgPSBiaW5kRnVuY3Rpb25EZWZzKHRhcmdldC5mdW5jdGlvbnMsICdUcmFuc2Zvcm0nKTtcbiAgICBsZXQgYWdncmVnYXRpb25GdW5jdGlvbnMgPSBiaW5kRnVuY3Rpb25EZWZzKHRhcmdldC5mdW5jdGlvbnMsICdBZ2dyZWdhdGUnKTtcbiAgICBsZXQgZmlsdGVyRnVuY3Rpb25zICAgICAgPSBiaW5kRnVuY3Rpb25EZWZzKHRhcmdldC5mdW5jdGlvbnMsICdGaWx0ZXInKTtcbiAgICBsZXQgYWxpYXNGdW5jdGlvbnMgICAgICAgPSBiaW5kRnVuY3Rpb25EZWZzKHRhcmdldC5mdW5jdGlvbnMsICdBbGlhcycpO1xuXG4gICAgLy8gQXBwbHkgdHJhbnNmb3JtYXRpb24gZnVuY3Rpb25zXG4gICAgdGltZXNlcmllc19kYXRhID0gXy5jbG9uZURlZXAoXy5tYXAodGltZXNlcmllc19kYXRhLCB0aW1lc2VyaWVzID0+IHtcbiAgICAgIHRpbWVzZXJpZXMuZGF0YXBvaW50cyA9IHNlcXVlbmNlKHRyYW5zZm9ybUZ1bmN0aW9ucykodGltZXNlcmllcy5kYXRhcG9pbnRzKTtcbiAgICAgIHJldHVybiB0aW1lc2VyaWVzO1xuICAgIH0pKTtcblxuICAgIC8vIEFwcGx5IGZpbHRlciBmdW5jdGlvbnNcbiAgICBpZiAoZmlsdGVyRnVuY3Rpb25zLmxlbmd0aCkge1xuICAgICAgdGltZXNlcmllc19kYXRhID0gc2VxdWVuY2UoZmlsdGVyRnVuY3Rpb25zKSh0aW1lc2VyaWVzX2RhdGEpO1xuICAgIH1cblxuICAgIC8vIEFwcGx5IGFnZ3JlZ2F0aW9uc1xuICAgIGlmIChhZ2dyZWdhdGlvbkZ1bmN0aW9ucy5sZW5ndGgpIHtcbiAgICAgIGxldCBkcCA9IF8ubWFwKHRpbWVzZXJpZXNfZGF0YSwgJ2RhdGFwb2ludHMnKTtcbiAgICAgIGRwID0gc2VxdWVuY2UoYWdncmVnYXRpb25GdW5jdGlvbnMpKGRwKTtcblxuICAgICAgbGV0IGFnZ0Z1bmNOYW1lcyA9IF8ubWFwKG1ldHJpY0Z1bmN0aW9ucy5nZXRDYXRlZ29yaWVzKClbJ0FnZ3JlZ2F0ZSddLCAnbmFtZScpO1xuICAgICAgbGV0IGxhc3RBZ2cgPSBfLmZpbmRMYXN0KHRhcmdldC5mdW5jdGlvbnMsIGZ1bmMgPT4ge1xuICAgICAgICByZXR1cm4gXy5pbmNsdWRlcyhhZ2dGdW5jTmFtZXMsIGZ1bmMuZGVmLm5hbWUpO1xuICAgICAgfSk7XG5cbiAgICAgIHRpbWVzZXJpZXNfZGF0YSA9IFt7XG4gICAgICAgIHRhcmdldDogbGFzdEFnZy50ZXh0LFxuICAgICAgICBkYXRhcG9pbnRzOiBkcFxuICAgICAgfV07XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgYWxpYXMgZnVuY3Rpb25zXG4gICAgXy5mb3JFYWNoKHRpbWVzZXJpZXNfZGF0YSwgc2VxdWVuY2UoYWxpYXNGdW5jdGlvbnMpKTtcblxuICAgIC8vIEFwcGx5IFRpbWUtcmVsYXRlZCBmdW5jdGlvbnMgKHRpbWVTaGlmdCgpLCBldGMpXG4gICAgLy8gRmluZCB0aW1lU2hpZnQoKSBmdW5jdGlvbiBhbmQgZ2V0IHNwZWNpZmllZCB0cmVuZCB2YWx1ZVxuICAgIHRoaXMuYXBwbHlUaW1lU2hpZnRGdW5jdGlvbih0aW1lc2VyaWVzX2RhdGEsIHRhcmdldCk7XG5cbiAgICByZXR1cm4gdGltZXNlcmllc19kYXRhO1xuICB9XG5cbiAgYXBwbHlUaW1lU2hpZnRGdW5jdGlvbih0aW1lc2VyaWVzX2RhdGEsIHRhcmdldCkge1xuICAgIC8vIEZpbmQgdGltZVNoaWZ0KCkgZnVuY3Rpb24gYW5kIGdldCBzcGVjaWZpZWQgaW50ZXJ2YWxcbiAgICBsZXQgdGltZVNoaWZ0RnVuYyA9IF8uZmluZCh0YXJnZXQuZnVuY3Rpb25zLCAoZnVuYykgPT4ge1xuICAgICAgcmV0dXJuIGZ1bmMuZGVmLm5hbWUgPT09ICd0aW1lU2hpZnQnO1xuICAgIH0pO1xuICAgIGlmICh0aW1lU2hpZnRGdW5jKSB7XG4gICAgICBsZXQgc2hpZnQgPSB0aW1lU2hpZnRGdW5jLnBhcmFtc1swXTtcbiAgICAgIF8uZm9yRWFjaCh0aW1lc2VyaWVzX2RhdGEsIChzZXJpZXMpID0+IHtcbiAgICAgICAgc2VyaWVzLmRhdGFwb2ludHMgPSBkYXRhUHJvY2Vzc29yLnVuU2hpZnRUaW1lU2VyaWVzKHNoaWZ0LCBzZXJpZXMuZGF0YXBvaW50cyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUXVlcnkgdGFyZ2V0IGRhdGEgZm9yIFRleHQgbW9kZVxuICAgKi9cbiAgcXVlcnlUZXh0RGF0YSh0YXJnZXQsIHRpbWVSYW5nZSkge1xuICAgIGxldCBbdGltZUZyb20sIHRpbWVUb10gPSB0aW1lUmFuZ2U7XG4gICAgbGV0IG9wdGlvbnMgPSB7XG4gICAgICBpdGVtdHlwZTogJ3RleHQnXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy56YWJiaXguZ2V0SXRlbXNGcm9tVGFyZ2V0KHRhcmdldCwgb3B0aW9ucylcbiAgICAgIC50aGVuKGl0ZW1zID0+IHtcbiAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnphYmJpeC5nZXRIaXN0b3J5KGl0ZW1zLCB0aW1lRnJvbSwgdGltZVRvKVxuICAgICAgICAgIC50aGVuKGhpc3RvcnkgPT4ge1xuICAgICAgICAgICAgaWYgKHRhcmdldC5yZXN1bHRGb3JtYXQgPT09ICd0YWJsZScpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlSGFuZGxlci5oYW5kbGVIaXN0b3J5QXNUYWJsZShoaXN0b3J5LCBpdGVtcywgdGFyZ2V0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXNwb25zZUhhbmRsZXIuaGFuZGxlVGV4dChoaXN0b3J5LCBpdGVtcywgdGFyZ2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFtdKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUXVlcnkgdGFyZ2V0IGRhdGEgZm9yIEl0ZW0gSUQgbW9kZVxuICAgKi9cbiAgcXVlcnlJdGVtSWREYXRhKHRhcmdldCwgdGltZVJhbmdlLCB1c2VUcmVuZHMsIG9wdGlvbnMpIHtcbiAgICBsZXQgaXRlbWlkcyA9IHRhcmdldC5pdGVtaWRzO1xuICAgIGl0ZW1pZHMgPSB0aGlzLnRlbXBsYXRlU3J2LnJlcGxhY2UoaXRlbWlkcywgb3B0aW9ucy5zY29wZWRWYXJzLCB6YWJiaXhJdGVtSWRzVGVtcGxhdGVGb3JtYXQpO1xuICAgIGl0ZW1pZHMgPSBfLm1hcChpdGVtaWRzLnNwbGl0KCcsJyksIGl0ZW1pZCA9PiBpdGVtaWQudHJpbSgpKTtcblxuICAgIGlmICghaXRlbWlkcykge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnphYmJpeC5nZXRJdGVtc0J5SURzKGl0ZW1pZHMpXG4gICAgLnRoZW4oaXRlbXMgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMucXVlcnlOdW1lcmljRGF0YUZvckl0ZW1zKGl0ZW1zLCB0YXJnZXQsIHRpbWVSYW5nZSwgdXNlVHJlbmRzLCBvcHRpb25zKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBRdWVyeSB0YXJnZXQgZGF0YSBmb3IgSVQgU2VydmljZXMgbW9kZVxuICAgKi9cbiAgcXVlcnlJVFNlcnZpY2VEYXRhKHRhcmdldCwgdGltZVJhbmdlLCBvcHRpb25zKSB7XG4gICAgLy8gRG9uJ3Qgc2hvdyB1bmRlZmluZWQgYW5kIGhpZGRlbiB0YXJnZXRzXG4gICAgaWYgKHRhcmdldC5oaWRlIHx8ICghdGFyZ2V0Lml0c2VydmljZSAmJiAhdGFyZ2V0Lml0U2VydmljZUZpbHRlcikgfHwgIXRhcmdldC5zbGFQcm9wZXJ0eSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGxldCBpdFNlcnZpY2VJZHMgPSBbXTtcbiAgICBsZXQgaXRTZXJ2aWNlcyA9IFtdO1xuICAgIGxldCBpdFNlcnZpY2VGaWx0ZXI7XG4gICAgbGV0IGlzT2xkVmVyc2lvbiA9IHRhcmdldC5pdHNlcnZpY2UgJiYgIXRhcmdldC5pdFNlcnZpY2VGaWx0ZXI7XG5cbiAgICBpZiAoaXNPbGRWZXJzaW9uKSB7XG4gICAgICAvLyBCYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gICAgICBpdFNlcnZpY2VGaWx0ZXIgPSAnLy4qLyc7XG4gICAgfSBlbHNlIHtcbiAgICAgIGl0U2VydmljZUZpbHRlciA9IHRoaXMucmVwbGFjZVRlbXBsYXRlVmFycyh0YXJnZXQuaXRTZXJ2aWNlRmlsdGVyLCBvcHRpb25zLnNjb3BlZFZhcnMpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnphYmJpeC5nZXRJVFNlcnZpY2VzKGl0U2VydmljZUZpbHRlcilcbiAgICAudGhlbihpdHNlcnZpY2VzID0+IHtcbiAgICAgIGl0U2VydmljZXMgPSBpdHNlcnZpY2VzO1xuICAgICAgaWYgKGlzT2xkVmVyc2lvbikge1xuICAgICAgICBpdFNlcnZpY2VzID0gXy5maWx0ZXIoaXRTZXJ2aWNlcywgeydzZXJ2aWNlaWQnOiB0YXJnZXQuaXRzZXJ2aWNlLnNlcnZpY2VpZH0pO1xuICAgICAgfVxuXG4gICAgICBpdFNlcnZpY2VJZHMgPSBfLm1hcChpdFNlcnZpY2VzLCAnc2VydmljZWlkJyk7XG4gICAgICByZXR1cm4gaXRTZXJ2aWNlSWRzO1xuICAgIH0pXG4gICAgLnRoZW4oc2VydmljZWlkcyA9PiB7XG4gICAgICByZXR1cm4gdGhpcy56YWJiaXguZ2V0U0xBKHNlcnZpY2VpZHMsIHRpbWVSYW5nZSk7XG4gICAgfSlcbiAgICAudGhlbihzbGFSZXNwb25zZSA9PiB7XG4gICAgICByZXR1cm4gXy5tYXAoaXRTZXJ2aWNlSWRzLCBzZXJ2aWNlaWQgPT4ge1xuICAgICAgICBsZXQgaXRzZXJ2aWNlID0gXy5maW5kKGl0U2VydmljZXMsIHsnc2VydmljZWlkJzogc2VydmljZWlkfSk7XG4gICAgICAgIHJldHVybiByZXNwb25zZUhhbmRsZXIuaGFuZGxlU0xBUmVzcG9uc2UoaXRzZXJ2aWNlLCB0YXJnZXQuc2xhUHJvcGVydHksIHNsYVJlc3BvbnNlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcXVlcnlUcmlnZ2Vyc0RhdGEodGFyZ2V0LCB0aW1lUmFuZ2UpIHtcbiAgICBsZXQgW3RpbWVGcm9tLCB0aW1lVG9dID0gdGltZVJhbmdlO1xuICAgIHJldHVybiB0aGlzLnphYmJpeC5nZXRIb3N0c0Zyb21UYXJnZXQodGFyZ2V0KVxuICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICBsZXQgW2hvc3RzLCBhcHBzXSA9IHJlc3VsdHM7XG4gICAgICBpZiAoaG9zdHMubGVuZ3RoKSB7XG4gICAgICAgIGxldCBob3N0aWRzID0gXy5tYXAoaG9zdHMsICdob3N0aWQnKTtcbiAgICAgICAgbGV0IGFwcGlkcyA9IF8ubWFwKGFwcHMsICdhcHBsaWNhdGlvbmlkJyk7XG4gICAgICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgICAgIG1pblNldmVyaXR5OiB0YXJnZXQudHJpZ2dlcnMubWluU2V2ZXJpdHksXG4gICAgICAgICAgYWNrbm93bGVkZ2VkOiB0YXJnZXQudHJpZ2dlcnMuYWNrbm93bGVkZ2VkLFxuICAgICAgICAgIGNvdW50OiB0YXJnZXQudHJpZ2dlcnMuY291bnQsXG4gICAgICAgICAgdGltZUZyb206IHRpbWVGcm9tLFxuICAgICAgICAgIHRpbWVUbzogdGltZVRvXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLnphYmJpeC5nZXRIb3N0QWxlcnRzKGhvc3RpZHMsIGFwcGlkcywgb3B0aW9ucylcbiAgICAgICAgLnRoZW4oKHRyaWdnZXJzKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlSGFuZGxlci5oYW5kbGVUcmlnZ2Vyc1Jlc3BvbnNlKHRyaWdnZXJzLCB0aW1lUmFuZ2UpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoW10pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFRlc3QgY29ubmVjdGlvbiB0byBaYWJiaXggQVBJXG4gICAqIEByZXR1cm4ge29iamVjdH0gQ29ubmVjdGlvbiBzdGF0dXMgYW5kIFphYmJpeCBBUEkgdmVyc2lvblxuICAgKi9cbiAgdGVzdERhdGFzb3VyY2UoKSB7XG4gICAgbGV0IHphYmJpeFZlcnNpb247XG4gICAgcmV0dXJuIHRoaXMuemFiYml4LmdldFZlcnNpb24oKVxuICAgIC50aGVuKHZlcnNpb24gPT4ge1xuICAgICAgemFiYml4VmVyc2lvbiA9IHZlcnNpb247XG4gICAgICByZXR1cm4gdGhpcy56YWJiaXgubG9naW4oKTtcbiAgICB9KVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmVuYWJsZURpcmVjdERCQ29ubmVjdGlvbikge1xuICAgICAgICByZXR1cm4gdGhpcy56YWJiaXguZGJDb25uZWN0b3IudGVzdFNRTERhdGFTb3VyY2UoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogXCJzdWNjZXNzXCIsXG4gICAgICAgIHRpdGxlOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgbWVzc2FnZTogXCJaYWJiaXggQVBJIHZlcnNpb246IFwiICsgemFiYml4VmVyc2lvblxuICAgICAgfTtcbiAgICB9KVxuICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBaYWJiaXhBUElFcnJvcikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN0YXR1czogXCJlcnJvclwiLFxuICAgICAgICAgIHRpdGxlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSBpZiAoZXJyb3IuZGF0YSAmJiBlcnJvci5kYXRhLm1lc3NhZ2UpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0dXM6IFwiZXJyb3JcIixcbiAgICAgICAgICB0aXRsZTogXCJDb25uZWN0aW9uIGZhaWxlZFwiLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiQ29ubmVjdGlvbiBmYWlsZWQ6IFwiICsgZXJyb3IuZGF0YS5tZXNzYWdlXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN0YXR1czogXCJlcnJvclwiLFxuICAgICAgICAgIHRpdGxlOiBcIkNvbm5lY3Rpb24gZmFpbGVkXCIsXG4gICAgICAgICAgbWVzc2FnZTogXCJDb3VsZCBub3QgY29ubmVjdCB0byBnaXZlbiB1cmxcIlxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLy8vLy8vLy8vLy8vLy8vL1xuICAvLyBUZW1wbGF0aW5nIC8vXG4gIC8vLy8vLy8vLy8vLy8vLy9cblxuICAvKipcbiAgICogRmluZCBtZXRyaWNzIGZyb20gdGVtcGxhdGVkIHJlcXVlc3QuXG4gICAqXG4gICAqIEBwYXJhbSAge3N0cmluZ30gcXVlcnkgUXVlcnkgZnJvbSBUZW1wbGF0aW5nXG4gICAqIEByZXR1cm4ge3N0cmluZ30gICAgICAgTWV0cmljIG5hbWUgLSBncm91cCwgaG9zdCwgYXBwIG9yIGl0ZW0gb3IgbGlzdFxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgIG9mIG1ldHJpY3MgaW4gXCJ7bWV0cmljMSxtZXRjaWMyLC4uLixtZXRyaWNOfVwiIGZvcm1hdC5cbiAgICovXG4gIG1ldHJpY0ZpbmRRdWVyeShxdWVyeSkge1xuICAgIGxldCByZXN1bHQ7XG4gICAgbGV0IHBhcnRzID0gW107XG5cbiAgICAvLyBTcGxpdCBxdWVyeS4gUXVlcnkgc3RydWN0dXJlOiBncm91cC5ob3N0LmFwcC5pdGVtXG4gICAgXy5lYWNoKHV0aWxzLnNwbGl0VGVtcGxhdGVRdWVyeShxdWVyeSksIHBhcnQgPT4ge1xuICAgICAgcGFydCA9IHRoaXMucmVwbGFjZVRlbXBsYXRlVmFycyhwYXJ0LCB7fSk7XG5cbiAgICAgIC8vIFJlcGxhY2Ugd2lsZGNhcmQgdG8gcmVnZXhcbiAgICAgIGlmIChwYXJ0ID09PSAnKicpIHtcbiAgICAgICAgcGFydCA9ICcvLiovJztcbiAgICAgIH1cbiAgICAgIHBhcnRzLnB1c2gocGFydCk7XG4gICAgfSk7XG4gICAgbGV0IHRlbXBsYXRlID0gXy56aXBPYmplY3QoWydncm91cCcsICdob3N0JywgJ2FwcCcsICdpdGVtJ10sIHBhcnRzKTtcblxuICAgIC8vIEdldCBpdGVtc1xuICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDQpIHtcbiAgICAgIC8vIFNlYXJjaCBmb3IgYWxsIGl0ZW1zLCBldmVuIGl0J3Mgbm90IGJlbG9uZyB0byBhbnkgYXBwbGljYXRpb25cbiAgICAgIGlmICh0ZW1wbGF0ZS5hcHAgPT09ICcvLiovJykge1xuICAgICAgICB0ZW1wbGF0ZS5hcHAgPSAnJztcbiAgICAgIH1cbiAgICAgIHJlc3VsdCA9IHRoaXMuemFiYml4LmdldEl0ZW1zKHRlbXBsYXRlLmdyb3VwLCB0ZW1wbGF0ZS5ob3N0LCB0ZW1wbGF0ZS5hcHAsIHRlbXBsYXRlLml0ZW0pO1xuICAgIH0gZWxzZSBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7XG4gICAgICAvLyBHZXQgYXBwbGljYXRpb25zXG4gICAgICByZXN1bHQgPSB0aGlzLnphYmJpeC5nZXRBcHBzKHRlbXBsYXRlLmdyb3VwLCB0ZW1wbGF0ZS5ob3N0LCB0ZW1wbGF0ZS5hcHApO1xuICAgIH0gZWxzZSBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7XG4gICAgICAvLyBHZXQgaG9zdHNcbiAgICAgIHJlc3VsdCA9IHRoaXMuemFiYml4LmdldEhvc3RzKHRlbXBsYXRlLmdyb3VwLCB0ZW1wbGF0ZS5ob3N0KTtcbiAgICB9IGVsc2UgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgLy8gR2V0IGdyb3Vwc1xuICAgICAgcmVzdWx0ID0gdGhpcy56YWJiaXguZ2V0R3JvdXBzKHRlbXBsYXRlLmdyb3VwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0ID0gUHJvbWlzZS5yZXNvbHZlKFtdKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0LnRoZW4obWV0cmljcyA9PiB7XG4gICAgICByZXR1cm4gXy5tYXAobWV0cmljcywgZm9ybWF0TWV0cmljKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vLy8vLy8vLy8vLy8vLy8vXG4gIC8vIEFubm90YXRpb25zIC8vXG4gIC8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgYW5ub3RhdGlvblF1ZXJ5KG9wdGlvbnMpIHtcbiAgICB2YXIgdGltZUZyb20gPSBNYXRoLmNlaWwoZGF0ZU1hdGgucGFyc2Uob3B0aW9ucy5yYW5nZVJhdy5mcm9tKSAvIDEwMDApO1xuICAgIHZhciB0aW1lVG8gPSBNYXRoLmNlaWwoZGF0ZU1hdGgucGFyc2Uob3B0aW9ucy5yYW5nZVJhdy50bykgLyAxMDAwKTtcbiAgICB2YXIgYW5ub3RhdGlvbiA9IG9wdGlvbnMuYW5ub3RhdGlvbjtcbiAgICB2YXIgc2hvd09rRXZlbnRzID0gYW5ub3RhdGlvbi5zaG93T2tFdmVudHMgPyBjLlNIT1dfQUxMX0VWRU5UUyA6IGMuU0hPV19PS19FVkVOVFM7XG5cbiAgICAvLyBTaG93IGFsbCB0cmlnZ2Vyc1xuICAgIGxldCB0cmlnZ2Vyc09wdGlvbnMgPSB7XG4gICAgICBzaG93VHJpZ2dlcnM6IGMuU0hPV19BTExfVFJJR0dFUlMsXG4gICAgICBoaWRlSG9zdHNJbk1haW50ZW5hbmNlOiBmYWxzZVxuICAgIH07XG5cbiAgICB2YXIgZ2V0VHJpZ2dlcnMgPSB0aGlzLnphYmJpeC5nZXRUcmlnZ2Vycyh0aGlzLnJlcGxhY2VUZW1wbGF0ZVZhcnMoYW5ub3RhdGlvbi5ncm91cCwge30pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZVRlbXBsYXRlVmFycyhhbm5vdGF0aW9uLmhvc3QsIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcGxhY2VUZW1wbGF0ZVZhcnMoYW5ub3RhdGlvbi5hcHBsaWNhdGlvbiwge30pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJzT3B0aW9ucyk7XG5cbiAgICByZXR1cm4gZ2V0VHJpZ2dlcnMudGhlbih0cmlnZ2VycyA9PiB7XG5cbiAgICAgIC8vIEZpbHRlciB0cmlnZ2VycyBieSBkZXNjcmlwdGlvblxuICAgICAgbGV0IHRyaWdnZXJOYW1lID0gdGhpcy5yZXBsYWNlVGVtcGxhdGVWYXJzKGFubm90YXRpb24udHJpZ2dlciwge30pO1xuICAgICAgaWYgKHV0aWxzLmlzUmVnZXgodHJpZ2dlck5hbWUpKSB7XG4gICAgICAgIHRyaWdnZXJzID0gXy5maWx0ZXIodHJpZ2dlcnMsIHRyaWdnZXIgPT4ge1xuICAgICAgICAgIHJldHVybiB1dGlscy5idWlsZFJlZ2V4KHRyaWdnZXJOYW1lKS50ZXN0KHRyaWdnZXIuZGVzY3JpcHRpb24pO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAodHJpZ2dlck5hbWUpIHtcbiAgICAgICAgdHJpZ2dlcnMgPSBfLmZpbHRlcih0cmlnZ2VycywgdHJpZ2dlciA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRyaWdnZXIuZGVzY3JpcHRpb24gPT09IHRyaWdnZXJOYW1lO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVtb3ZlIGV2ZW50cyBiZWxvdyB0aGUgY2hvc2Ugc2V2ZXJpdHlcbiAgICAgIHRyaWdnZXJzID0gXy5maWx0ZXIodHJpZ2dlcnMsIHRyaWdnZXIgPT4ge1xuICAgICAgICByZXR1cm4gTnVtYmVyKHRyaWdnZXIucHJpb3JpdHkpID49IE51bWJlcihhbm5vdGF0aW9uLm1pbnNldmVyaXR5KTtcbiAgICAgIH0pO1xuXG4gICAgICB2YXIgb2JqZWN0aWRzID0gXy5tYXAodHJpZ2dlcnMsICd0cmlnZ2VyaWQnKTtcbiAgICAgIHJldHVybiB0aGlzLnphYmJpeFxuICAgICAgICAuZ2V0RXZlbnRzKG9iamVjdGlkcywgdGltZUZyb20sIHRpbWVUbywgc2hvd09rRXZlbnRzKVxuICAgICAgICAudGhlbihldmVudHMgPT4ge1xuICAgICAgICAgIHZhciBpbmRleGVkVHJpZ2dlcnMgPSBfLmtleUJ5KHRyaWdnZXJzLCAndHJpZ2dlcmlkJyk7XG5cbiAgICAgICAgICAvLyBIaWRlIGFja25vd2xlZGdlZCBldmVudHMgaWYgb3B0aW9uIGVuYWJsZWRcbiAgICAgICAgICBpZiAoYW5ub3RhdGlvbi5oaWRlQWNrbm93bGVkZ2VkKSB7XG4gICAgICAgICAgICBldmVudHMgPSBfLmZpbHRlcihldmVudHMsIGV2ZW50ID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuICFldmVudC5hY2tub3dsZWRnZXMubGVuZ3RoO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIF8ubWFwKGV2ZW50cywgZXZlbnQgPT4ge1xuICAgICAgICAgICAgbGV0IHRhZ3M7XG4gICAgICAgICAgICBpZiAoYW5ub3RhdGlvbi5zaG93SG9zdG5hbWUpIHtcbiAgICAgICAgICAgICAgdGFncyA9IF8ubWFwKGV2ZW50Lmhvc3RzLCAnbmFtZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTaG93IGV2ZW50IHR5cGUgKE9LIG9yIFByb2JsZW0pXG4gICAgICAgICAgICBsZXQgdGl0bGUgPSBOdW1iZXIoZXZlbnQudmFsdWUpID8gJ1Byb2JsZW0nIDogJ09LJztcblxuICAgICAgICAgICAgbGV0IGZvcm1hdHRlZF9hY2tub3dsZWRnZXMgPSB1dGlscy5mb3JtYXRBY2tub3dsZWRnZXMoZXZlbnQuYWNrbm93bGVkZ2VzKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGFubm90YXRpb246IGFubm90YXRpb24sXG4gICAgICAgICAgICAgIHRpbWU6IGV2ZW50LmNsb2NrICogMTAwMCxcbiAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICAgICAgICB0YWdzOiB0YWdzLFxuICAgICAgICAgICAgICB0ZXh0OiBpbmRleGVkVHJpZ2dlcnNbZXZlbnQub2JqZWN0aWRdLmRlc2NyaXB0aW9uICsgZm9ybWF0dGVkX2Fja25vd2xlZGdlc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRyaWdnZXJzIGFuZCBpdHMgZGV0YWlscyBmb3IgcGFuZWwncyB0YXJnZXRzXG4gICAqIFJldHVybnMgYWxlcnQgc3RhdGUgKCdvaycgaWYgbm8gZmlyZWQgdHJpZ2dlcnMsIG9yICdhbGVydGluZycgaWYgYXQgbGVhc3QgMSB0cmlnZ2VyIGlzIGZpcmVkKVxuICAgKiBvciBlbXB0eSBvYmplY3QgaWYgbm8gcmVsYXRlZCB0cmlnZ2VycyBhcmUgZmluZGVkLlxuICAgKi9cbiAgYWxlcnRRdWVyeShvcHRpb25zKSB7XG4gICAgbGV0IGVuYWJsZWRfdGFyZ2V0cyA9IGZpbHRlckVuYWJsZWRUYXJnZXRzKG9wdGlvbnMudGFyZ2V0cyk7XG4gICAgbGV0IGdldFBhbmVsSXRlbXMgPSBfLm1hcChlbmFibGVkX3RhcmdldHMsIHQgPT4ge1xuICAgICAgbGV0IHRhcmdldCA9IF8uY2xvbmVEZWVwKHQpO1xuICAgICAgdGhpcy5yZXBsYWNlVGFyZ2V0VmFyaWFibGVzKHRhcmdldCwgb3B0aW9ucyk7XG4gICAgICByZXR1cm4gdGhpcy56YWJiaXguZ2V0SXRlbXNGcm9tVGFyZ2V0KHRhcmdldCwge2l0ZW10eXBlOiAnbnVtJ30pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGdldFBhbmVsSXRlbXMpXG4gICAgLnRoZW4ocmVzdWx0cyA9PiB7XG4gICAgICBsZXQgaXRlbXMgPSBfLmZsYXR0ZW4ocmVzdWx0cyk7XG4gICAgICBsZXQgaXRlbWlkcyA9IF8ubWFwKGl0ZW1zLCAnaXRlbWlkJyk7XG5cbiAgICAgIGlmIChpdGVtaWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy56YWJiaXguZ2V0QWxlcnRzKGl0ZW1pZHMpO1xuICAgIH0pXG4gICAgLnRoZW4odHJpZ2dlcnMgPT4ge1xuICAgICAgdHJpZ2dlcnMgPSBfLmZpbHRlcih0cmlnZ2VycywgdHJpZ2dlciA9PiB7XG4gICAgICAgIHJldHVybiB0cmlnZ2VyLnByaW9yaXR5ID49IHRoaXMuYWxlcnRpbmdNaW5TZXZlcml0eTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXRyaWdnZXJzIHx8IHRyaWdnZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4ge307XG4gICAgICB9XG5cbiAgICAgIGxldCBzdGF0ZSA9ICdvayc7XG5cbiAgICAgIGxldCBmaXJlZFRyaWdnZXJzID0gXy5maWx0ZXIodHJpZ2dlcnMsIHt2YWx1ZTogJzEnfSk7XG4gICAgICBpZiAoZmlyZWRUcmlnZ2Vycy5sZW5ndGgpIHtcbiAgICAgICAgc3RhdGUgPSAnYWxlcnRpbmcnO1xuICAgICAgfVxuXG4gICAgICBsZXQgdGhyZXNob2xkcyA9IF8ubWFwKHRyaWdnZXJzLCB0cmlnZ2VyID0+IHtcbiAgICAgICAgcmV0dXJuIGdldFRyaWdnZXJUaHJlc2hvbGQodHJpZ2dlci5leHByZXNzaW9uKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwYW5lbElkOiBvcHRpb25zLnBhbmVsSWQsXG4gICAgICAgIHN0YXRlOiBzdGF0ZSxcbiAgICAgICAgdGhyZXNob2xkczogdGhyZXNob2xkc1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFJlcGxhY2UgdGVtcGxhdGUgdmFyaWFibGVzXG4gIHJlcGxhY2VUYXJnZXRWYXJpYWJsZXModGFyZ2V0LCBvcHRpb25zKSB7XG4gICAgbGV0IHBhcnRzID0gWydncm91cCcsICdob3N0JywgJ2FwcGxpY2F0aW9uJywgJ2l0ZW0nXTtcbiAgICBfLmZvckVhY2gocGFydHMsIHAgPT4ge1xuICAgICAgaWYgKHRhcmdldFtwXSAmJiB0YXJnZXRbcF0uZmlsdGVyKSB7XG4gICAgICAgIHRhcmdldFtwXS5maWx0ZXIgPSB0aGlzLnJlcGxhY2VUZW1wbGF0ZVZhcnModGFyZ2V0W3BdLmZpbHRlciwgb3B0aW9ucy5zY29wZWRWYXJzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0YXJnZXQudGV4dEZpbHRlciA9IHRoaXMucmVwbGFjZVRlbXBsYXRlVmFycyh0YXJnZXQudGV4dEZpbHRlciwgb3B0aW9ucy5zY29wZWRWYXJzKTtcblxuICAgIF8uZm9yRWFjaCh0YXJnZXQuZnVuY3Rpb25zLCBmdW5jID0+IHtcbiAgICAgIGZ1bmMucGFyYW1zID0gXy5tYXAoZnVuYy5wYXJhbXMsIHBhcmFtID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBwYXJhbSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICByZXR1cm4gK3RoaXMudGVtcGxhdGVTcnYucmVwbGFjZShwYXJhbS50b1N0cmluZygpLCBvcHRpb25zLnNjb3BlZFZhcnMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB0aGlzLnRlbXBsYXRlU3J2LnJlcGxhY2UocGFyYW0sIG9wdGlvbnMuc2NvcGVkVmFycyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgaXNVc2VUcmVuZHModGltZVJhbmdlKSB7XG4gICAgbGV0IFt0aW1lRnJvbSwgdGltZVRvXSA9IHRpbWVSYW5nZTtcbiAgICBsZXQgdXNlVHJlbmRzRnJvbSA9IE1hdGguY2VpbChkYXRlTWF0aC5wYXJzZSgnbm93LScgKyB0aGlzLnRyZW5kc0Zyb20pIC8gMTAwMCk7XG4gICAgbGV0IHVzZVRyZW5kc1JhbmdlID0gTWF0aC5jZWlsKHV0aWxzLnBhcnNlSW50ZXJ2YWwodGhpcy50cmVuZHNSYW5nZSkgLyAxMDAwKTtcbiAgICBsZXQgdXNlVHJlbmRzID0gdGhpcy50cmVuZHMgJiYgKFxuICAgICAgKHRpbWVGcm9tIDw9IHVzZVRyZW5kc0Zyb20pIHx8XG4gICAgICAodGltZVRvIC0gdGltZUZyb20gPj0gdXNlVHJlbmRzUmFuZ2UpXG4gICAgKTtcbiAgICByZXR1cm4gdXNlVHJlbmRzO1xuICB9XG59XG5cbmZ1bmN0aW9uIGJpbmRGdW5jdGlvbkRlZnMoZnVuY3Rpb25EZWZzLCBjYXRlZ29yeSkge1xuICB2YXIgYWdncmVnYXRpb25GdW5jdGlvbnMgPSBfLm1hcChtZXRyaWNGdW5jdGlvbnMuZ2V0Q2F0ZWdvcmllcygpW2NhdGVnb3J5XSwgJ25hbWUnKTtcbiAgdmFyIGFnZ0Z1bmNEZWZzID0gXy5maWx0ZXIoZnVuY3Rpb25EZWZzLCBmdW5jdGlvbihmdW5jKSB7XG4gICAgcmV0dXJuIF8uaW5jbHVkZXMoYWdncmVnYXRpb25GdW5jdGlvbnMsIGZ1bmMuZGVmLm5hbWUpO1xuICB9KTtcblxuICByZXR1cm4gXy5tYXAoYWdnRnVuY0RlZnMsIGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICB2YXIgZnVuY0luc3RhbmNlID0gbWV0cmljRnVuY3Rpb25zLmNyZWF0ZUZ1bmNJbnN0YW5jZShmdW5jLmRlZiwgZnVuYy5wYXJhbXMpO1xuICAgIHJldHVybiBmdW5jSW5zdGFuY2UuYmluZEZ1bmN0aW9uKGRhdGFQcm9jZXNzb3IubWV0cmljRnVuY3Rpb25zKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldENvbnNvbGlkYXRlQnkodGFyZ2V0KSB7XG4gIGxldCBjb25zb2xpZGF0ZUJ5ID0gJ2F2Zyc7XG4gIGxldCBmdW5jRGVmID0gXy5maW5kKHRhcmdldC5mdW5jdGlvbnMsIGZ1bmMgPT4ge1xuICAgIHJldHVybiBmdW5jLmRlZi5uYW1lID09PSAnY29uc29saWRhdGVCeSc7XG4gIH0pO1xuICBpZiAoZnVuY0RlZiAmJiBmdW5jRGVmLnBhcmFtcyAmJiBmdW5jRGVmLnBhcmFtcy5sZW5ndGgpIHtcbiAgICBjb25zb2xpZGF0ZUJ5ID0gZnVuY0RlZi5wYXJhbXNbMF07XG4gIH1cbiAgcmV0dXJuIGNvbnNvbGlkYXRlQnk7XG59XG5cbmZ1bmN0aW9uIGRvd25zYW1wbGVTZXJpZXModGltZXNlcmllc19kYXRhLCBvcHRpb25zKSB7XG4gIGxldCBkZWZhdWx0QWdnID0gZGF0YVByb2Nlc3Nvci5hZ2dyZWdhdGlvbkZ1bmN0aW9uc1snYXZnJ107XG4gIGxldCBjb25zb2xpZGF0ZUJ5RnVuYyA9IGRhdGFQcm9jZXNzb3IuYWdncmVnYXRpb25GdW5jdGlvbnNbb3B0aW9ucy5jb25zb2xpZGF0ZUJ5XSB8fCBkZWZhdWx0QWdnO1xuICByZXR1cm4gXy5tYXAodGltZXNlcmllc19kYXRhLCB0aW1lc2VyaWVzID0+IHtcbiAgICBpZiAodGltZXNlcmllcy5kYXRhcG9pbnRzLmxlbmd0aCA+IG9wdGlvbnMubWF4RGF0YVBvaW50cykge1xuICAgICAgdGltZXNlcmllcy5kYXRhcG9pbnRzID0gZGF0YVByb2Nlc3NvclxuICAgICAgICAuZ3JvdXBCeShvcHRpb25zLmludGVydmFsLCBjb25zb2xpZGF0ZUJ5RnVuYywgdGltZXNlcmllcy5kYXRhcG9pbnRzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRpbWVzZXJpZXM7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBmb3JtYXRNZXRyaWMobWV0cmljT2JqKSB7XG4gIHJldHVybiB7XG4gICAgdGV4dDogbWV0cmljT2JqLm5hbWUsXG4gICAgZXhwYW5kYWJsZTogZmFsc2VcbiAgfTtcbn1cblxuLyoqXG4gKiBDdXN0b20gZm9ybWF0dGVyIGZvciB0ZW1wbGF0ZSB2YXJpYWJsZXMuXG4gKiBEZWZhdWx0IEdyYWZhbmEgXCJyZWdleFwiIGZvcm1hdHRlciByZXR1cm5zXG4gKiB2YWx1ZTF8dmFsdWUyXG4gKiBUaGlzIGZvcm1hdHRlciByZXR1cm5zXG4gKiAodmFsdWUxfHZhbHVlMilcbiAqIFRoaXMgZm9ybWF0IG5lZWRlZCBmb3IgdXNpbmcgaW4gY29tcGxleCByZWdleCB3aXRoXG4gKiB0ZW1wbGF0ZSB2YXJpYWJsZXMsIGZvciBleGFtcGxlXG4gKiAvQ1BVICRjcHVfaXRlbS4qdGltZS8gd2hlcmUgJGNwdV9pdGVtIGlzIHN5c3RlbSx1c2VyLGlvd2FpdFxuICovXG5mdW5jdGlvbiB6YWJiaXhUZW1wbGF0ZUZvcm1hdCh2YWx1ZSkge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiB1dGlscy5lc2NhcGVSZWdleCh2YWx1ZSk7XG4gIH1cblxuICB2YXIgZXNjYXBlZFZhbHVlcyA9IF8ubWFwKHZhbHVlLCB1dGlscy5lc2NhcGVSZWdleCk7XG4gIHJldHVybiAnKCcgKyBlc2NhcGVkVmFsdWVzLmpvaW4oJ3wnKSArICcpJztcbn1cblxuZnVuY3Rpb24gemFiYml4SXRlbUlkc1RlbXBsYXRlRm9ybWF0KHZhbHVlKSB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIHJldHVybiB2YWx1ZS5qb2luKCcsJyk7XG59XG5cbi8qKlxuICogSWYgdGVtcGxhdGUgdmFyaWFibGVzIGFyZSB1c2VkIGluIHJlcXVlc3QsIHJlcGxhY2UgaXQgdXNpbmcgcmVnZXggZm9ybWF0XG4gKiBhbmQgd3JhcCB3aXRoICcvJyBmb3IgcHJvcGVyIG11bHRpLXZhbHVlIHdvcmsuIEV4YW1wbGU6XG4gKiAkdmFyaWFibGUgc2VsZWN0ZWQgYXMgYSwgYiwgY1xuICogV2UgdXNlIGZpbHRlciAkdmFyaWFibGVcbiAqICR2YXJpYWJsZSAgICAtPiBhfGJ8YyAgICAtPiAvYXxifGMvXG4gKiAvJHZhcmlhYmxlLyAgLT4gL2F8YnxjLyAgLT4gL2F8YnxjL1xuICovXG5mdW5jdGlvbiByZXBsYWNlVGVtcGxhdGVWYXJzKHRlbXBsYXRlU3J2LCB0YXJnZXQsIHNjb3BlZFZhcnMpIHtcbiAgdmFyIHJlcGxhY2VkVGFyZ2V0ID0gdGVtcGxhdGVTcnYucmVwbGFjZSh0YXJnZXQsIHNjb3BlZFZhcnMsIHphYmJpeFRlbXBsYXRlRm9ybWF0KTtcbiAgaWYgKHRhcmdldCAhPT0gcmVwbGFjZWRUYXJnZXQgJiYgIXV0aWxzLmlzUmVnZXgocmVwbGFjZWRUYXJnZXQpKSB7XG4gICAgcmVwbGFjZWRUYXJnZXQgPSAnL14nICsgcmVwbGFjZWRUYXJnZXQgKyAnJC8nO1xuICB9XG4gIHJldHVybiByZXBsYWNlZFRhcmdldDtcbn1cblxuLy8gQXBwbHkgZnVuY3Rpb24gb25lIGJ5IG9uZTpcbi8vIHNlcXVlbmNlKFthKCksIGIoKSwgYygpXSkgPSBjKGIoYSgpKSk7XG5mdW5jdGlvbiBzZXF1ZW5jZShmdW5jc0FycmF5KSB7XG4gIHJldHVybiBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZ1bmNzQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIHJlc3VsdCA9IGZ1bmNzQXJyYXlbaV0uY2FsbCh0aGlzLCByZXN1bHQpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xufVxuXG5mdW5jdGlvbiBmaWx0ZXJFbmFibGVkVGFyZ2V0cyh0YXJnZXRzKSB7XG4gIHJldHVybiBfLmZpbHRlcih0YXJnZXRzLCB0YXJnZXQgPT4ge1xuICAgIHJldHVybiAhKHRhcmdldC5oaWRlIHx8ICF0YXJnZXQuZ3JvdXAgfHwgIXRhcmdldC5ob3N0IHx8ICF0YXJnZXQuaXRlbSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRUcmlnZ2VyVGhyZXNob2xkKGV4cHJlc3Npb24pIHtcbiAgbGV0IHRocmVzaG9sZFBhdHRlcm4gPSAvLipbPD49XXsxLDJ9KFtcXGRcXC5dKykvO1xuICBsZXQgZmluZGVkX3RocmVzaG9sZHMgPSBleHByZXNzaW9uLm1hdGNoKHRocmVzaG9sZFBhdHRlcm4pO1xuICBpZiAoZmluZGVkX3RocmVzaG9sZHMgJiYgZmluZGVkX3RocmVzaG9sZHMubGVuZ3RoID49IDIpIHtcbiAgICBsZXQgdGhyZXNob2xkID0gZmluZGVkX3RocmVzaG9sZHNbMV07XG4gICAgdGhyZXNob2xkID0gTnVtYmVyKHRocmVzaG9sZCk7XG4gICAgcmV0dXJuIHRocmVzaG9sZDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5leHBvcnQge1phYmJpeEFQSURhdGFzb3VyY2UsIHphYmJpeFRlbXBsYXRlRm9ybWF0fTtcblxuLy8gRml4IGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IHdpdGggbG9kYXNoIDIuNFxuaWYgKCFfLmluY2x1ZGVzKSB7Xy5pbmNsdWRlcyA9IF8uY29udGFpbnM7fVxuaWYgKCFfLmtleUJ5KSB7Xy5rZXlCeSA9IF8uaW5kZXhCeTt9XG4iXX0=