15b73335a80a264585e088fbffe19ebe
'use strict';Object.defineProperty(exports, "__esModule", { value: true });exports.CURRENT_SCHEMA_VERSION = undefined;exports.





migratePanelSchema = migratePanelSchema;var _lodash = require('lodash');var _lodash2 = _interopRequireDefault(_lodash);var _triggers_panel_ctrl = require('./triggers_panel_ctrl');function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };} // Actual schema version
var CURRENT_SCHEMA_VERSION = exports.CURRENT_SCHEMA_VERSION = 4;function migratePanelSchema(panel) {if (isEmptyPanel(panel)) {
    return panel;
  }

  var schemaVersion = getSchemaVersion(panel);
  panel.schemaVersion = CURRENT_SCHEMA_VERSION;

  if (schemaVersion < 2) {
    panel.datasources = [panel.datasource];
    panel.targets = {};
    panel.targets[panel.datasources[0]] = panel.triggers;

    // delete old props
    delete panel.triggers;
    delete panel.datasource;
  }

  if (schemaVersion < 3) {
    // delete old props
    delete panel.lastChangeField;
    delete panel.ageField;
    delete panel.infoField;
    delete panel.scroll;
    delete panel.hideHostsInMaintenance;
  }

  if (schemaVersion < 4) {
    if (panel.targets && !_lodash2.default.isEmpty(panel.targets)) {
      _lodash2.default.each(panel.targets, function (target) {
        _lodash2.default.defaultsDeep(target, _triggers_panel_ctrl.DEFAULT_TARGET);
      });
    }
  }

  return panel;
}

function getSchemaVersion(panel) {
  return panel.schemaVersion || 1;
}

function isEmptyPanel(panel) {
  return !panel.datasource && !panel.datasources && !panel.triggers && !panel.targets;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1pZ3JhdGlvbnMuanMiXSwibmFtZXMiOlsibWlncmF0ZVBhbmVsU2NoZW1hIiwiQ1VSUkVOVF9TQ0hFTUFfVkVSU0lPTiIsInBhbmVsIiwiaXNFbXB0eVBhbmVsIiwic2NoZW1hVmVyc2lvbiIsImdldFNjaGVtYVZlcnNpb24iLCJkYXRhc291cmNlcyIsImRhdGFzb3VyY2UiLCJ0YXJnZXRzIiwidHJpZ2dlcnMiLCJsYXN0Q2hhbmdlRmllbGQiLCJhZ2VGaWVsZCIsImluZm9GaWVsZCIsInNjcm9sbCIsImhpZGVIb3N0c0luTWFpbnRlbmFuY2UiLCJfIiwiaXNFbXB0eSIsImVhY2giLCJ0YXJnZXQiLCJkZWZhdWx0c0RlZXAiLCJERUZBVUxUX1RBUkdFVCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBTWdCQSxrQixHQUFBQSxrQixDQU5oQixnQywrQ0FDQSw0RCw4RkFFQTtBQUNPLElBQU1DLDBEQUF5QixDQUEvQixDQUVBLFNBQVNELGtCQUFULENBQTRCRSxLQUE1QixFQUFtQyxDQUN4QyxJQUFJQyxhQUFhRCxLQUFiLENBQUosRUFBeUI7QUFDdkIsV0FBT0EsS0FBUDtBQUNEOztBQUVELE1BQU1FLGdCQUFnQkMsaUJBQWlCSCxLQUFqQixDQUF0QjtBQUNBQSxRQUFNRSxhQUFOLEdBQXNCSCxzQkFBdEI7O0FBRUEsTUFBSUcsZ0JBQWdCLENBQXBCLEVBQXVCO0FBQ3JCRixVQUFNSSxXQUFOLEdBQW9CLENBQUNKLE1BQU1LLFVBQVAsQ0FBcEI7QUFDQUwsVUFBTU0sT0FBTixHQUFnQixFQUFoQjtBQUNBTixVQUFNTSxPQUFOLENBQWNOLE1BQU1JLFdBQU4sQ0FBa0IsQ0FBbEIsQ0FBZCxJQUFzQ0osTUFBTU8sUUFBNUM7O0FBRUE7QUFDQSxXQUFPUCxNQUFNTyxRQUFiO0FBQ0EsV0FBT1AsTUFBTUssVUFBYjtBQUNEOztBQUVELE1BQUlILGdCQUFnQixDQUFwQixFQUF1QjtBQUNyQjtBQUNBLFdBQU9GLE1BQU1RLGVBQWI7QUFDQSxXQUFPUixNQUFNUyxRQUFiO0FBQ0EsV0FBT1QsTUFBTVUsU0FBYjtBQUNBLFdBQU9WLE1BQU1XLE1BQWI7QUFDQSxXQUFPWCxNQUFNWSxzQkFBYjtBQUNEOztBQUVELE1BQUlWLGdCQUFnQixDQUFwQixFQUF1QjtBQUNyQixRQUFJRixNQUFNTSxPQUFOLElBQWlCLENBQUNPLGlCQUFFQyxPQUFGLENBQVVkLE1BQU1NLE9BQWhCLENBQXRCLEVBQWdEO0FBQzlDTyx1QkFBRUUsSUFBRixDQUFPZixNQUFNTSxPQUFiLEVBQXNCLFVBQUNVLE1BQUQsRUFBWTtBQUNoQ0gseUJBQUVJLFlBQUYsQ0FBZUQsTUFBZixFQUF1QkUsbUNBQXZCO0FBQ0QsT0FGRDtBQUdEO0FBQ0Y7O0FBRUQsU0FBT2xCLEtBQVA7QUFDRDs7QUFFRCxTQUFTRyxnQkFBVCxDQUEwQkgsS0FBMUIsRUFBaUM7QUFDL0IsU0FBT0EsTUFBTUUsYUFBTixJQUF1QixDQUE5QjtBQUNEOztBQUVELFNBQVNELFlBQVQsQ0FBc0JELEtBQXRCLEVBQTZCO0FBQzNCLFNBQU8sQ0FBQ0EsTUFBTUssVUFBUCxJQUFxQixDQUFDTCxNQUFNSSxXQUE1QixJQUEyQyxDQUFDSixNQUFNTyxRQUFsRCxJQUE4RCxDQUFDUCxNQUFNTSxPQUE1RTtBQUNEIiwiZmlsZSI6Im1pZ3JhdGlvbnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHtERUZBVUxUX1RBUkdFVH0gZnJvbSAnLi90cmlnZ2Vyc19wYW5lbF9jdHJsJztcblxuLy8gQWN0dWFsIHNjaGVtYSB2ZXJzaW9uXG5leHBvcnQgY29uc3QgQ1VSUkVOVF9TQ0hFTUFfVkVSU0lPTiA9IDQ7XG5cbmV4cG9ydCBmdW5jdGlvbiBtaWdyYXRlUGFuZWxTY2hlbWEocGFuZWwpIHtcbiAgaWYgKGlzRW1wdHlQYW5lbChwYW5lbCkpIHtcbiAgICByZXR1cm4gcGFuZWw7XG4gIH1cblxuICBjb25zdCBzY2hlbWFWZXJzaW9uID0gZ2V0U2NoZW1hVmVyc2lvbihwYW5lbCk7XG4gIHBhbmVsLnNjaGVtYVZlcnNpb24gPSBDVVJSRU5UX1NDSEVNQV9WRVJTSU9OO1xuXG4gIGlmIChzY2hlbWFWZXJzaW9uIDwgMikge1xuICAgIHBhbmVsLmRhdGFzb3VyY2VzID0gW3BhbmVsLmRhdGFzb3VyY2VdO1xuICAgIHBhbmVsLnRhcmdldHMgPSB7fTtcbiAgICBwYW5lbC50YXJnZXRzW3BhbmVsLmRhdGFzb3VyY2VzWzBdXSA9IHBhbmVsLnRyaWdnZXJzO1xuXG4gICAgLy8gZGVsZXRlIG9sZCBwcm9wc1xuICAgIGRlbGV0ZSBwYW5lbC50cmlnZ2VycztcbiAgICBkZWxldGUgcGFuZWwuZGF0YXNvdXJjZTtcbiAgfVxuXG4gIGlmIChzY2hlbWFWZXJzaW9uIDwgMykge1xuICAgIC8vIGRlbGV0ZSBvbGQgcHJvcHNcbiAgICBkZWxldGUgcGFuZWwubGFzdENoYW5nZUZpZWxkO1xuICAgIGRlbGV0ZSBwYW5lbC5hZ2VGaWVsZDtcbiAgICBkZWxldGUgcGFuZWwuaW5mb0ZpZWxkO1xuICAgIGRlbGV0ZSBwYW5lbC5zY3JvbGw7XG4gICAgZGVsZXRlIHBhbmVsLmhpZGVIb3N0c0luTWFpbnRlbmFuY2U7XG4gIH1cblxuICBpZiAoc2NoZW1hVmVyc2lvbiA8IDQpIHtcbiAgICBpZiAocGFuZWwudGFyZ2V0cyAmJiAhXy5pc0VtcHR5KHBhbmVsLnRhcmdldHMpKSB7XG4gICAgICBfLmVhY2gocGFuZWwudGFyZ2V0cywgKHRhcmdldCkgPT4ge1xuICAgICAgICBfLmRlZmF1bHRzRGVlcCh0YXJnZXQsIERFRkFVTFRfVEFSR0VUKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBwYW5lbDtcbn1cblxuZnVuY3Rpb24gZ2V0U2NoZW1hVmVyc2lvbihwYW5lbCkge1xuICByZXR1cm4gcGFuZWwuc2NoZW1hVmVyc2lvbiB8fCAxO1xufVxuXG5mdW5jdGlvbiBpc0VtcHR5UGFuZWwocGFuZWwpIHtcbiAgcmV0dXJuICFwYW5lbC5kYXRhc291cmNlICYmICFwYW5lbC5kYXRhc291cmNlcyAmJiAhcGFuZWwudHJpZ2dlcnMgJiYgIXBhbmVsLnRhcmdldHM7XG59XG4iXX0=